
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Monads</title>
<meta name="description" content="Documentation of Coq module Monads" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Monads</h1>
<div class="coq">
<div class="doc">Hoare monads and Dijkstra monads </div>
<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Program</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span>.<br/>
<span class="id">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="id"><a href="CDF.Hoare.html">Hoare</a></span> <span class="id"><a href="CDF.Separation.html">Separation</a></span> <span class="id"><a href="CDF.Delay.html">Delay</a></span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">inv</span> <span class="id">H</span> := <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
<br/>
<h1> Hoare monads </h1>
<br/>
<h2> The generic interface </h2>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="HOAREMONAD">HOAREMONAD</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.PRE">PRE</a></span>: <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="HOAREMONAD.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.M">M</a></span>: <span class="kwd">forall</span> (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span>) (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">A</span>), <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.ret">ret</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">A</span>) (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">A</span> <span class="id">Q</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.bind">bind</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">A</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span> -&gt; (<span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">B</span> <span class="id">R</span>) -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span> <span class="id">B</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.implies">implies</a></span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span> -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.consequence_pre">consequence_pre</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#HOAREMONAD.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span> -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span> -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="HOAREMONAD.consequence_post">consequence_post</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HOAREMONAD.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HOAREMONAD.POST">POST</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HOAREMONAD.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>))-&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span> -&gt; <span class="id"><a href="CDF.Monads.html#HOAREMONAD.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>'.<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HOAREMONAD">HOAREMONAD</a></span>.<br/>
<br/>
<h2> The Hoare monad of pure computations </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="HPure">HPure</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#HOAREMONAD">HOAREMONAD</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.PRE">PRE</a></span> := <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.M">M</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>) (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">A</span>) := <span class="id">P</span> -&gt; { <span class="id">a</span> : <span class="id">A</span> | <span class="id">Q</span> <span class="id">a</span> }.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">A</span>) (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">v</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">A</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span>: <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">B</span> <span class="id">R</span>) : <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span> <span class="id">B</span> <span class="id">R</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="kwd">let</span> '(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">b</span> <span class="id">r</span>) := <span class="id">a</span> <span class="id">p</span> <span class="kwd">in</span> <span class="id">f</span> <span class="id">b</span> <span class="id">r</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.implies">implies</a></span> (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>) := <span class="id">P</span> -&gt; <span class="id">P</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HPure.consequence_pre">consequence_pre</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="id"><a href="CDF.Monads.html#HPure.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span>' =&gt; <span class="id">m</span> (<span class="id">IMP</span> <span class="id">p</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HPure.consequence_post">consequence_post</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HPure.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HPure.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HPure.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HPure.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">m</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof232')">Next Obligation.</div>
<div class="proofscript" id="proof232">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m</span> <span class="id">p</span>); <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id">IMP</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HPure">HPure</a></span>.<br/>
<br/>
<h2> The Hoare monad of possibly-diverging computations </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="HDiv">HDiv</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#HOAREMONAD">HOAREMONAD</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Delay</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.PRE">PRE</a></span> := <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.M">M</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">A</span>) := <span class="id">P</span> -&gt; { <span class="id">d</span> : <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> <span class="id">A</span> | <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id">Q</span> <span class="id">d</span> }.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HDiv.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">A</span>) (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="CDF.Delay.html#now">now</a></span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof233')">Next Obligation.</div>
<div class="proofscript" id="proof233">
&nbsp;&nbsp;<span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="HDiv.BIND">BIND</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">A</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span>: <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">B</span> <span class="id">R</span>).<br/>
<br/>
<span class="kwd">CoFixpoint</span> <span class="id"><a name="HDiv.bind_aux">bind_aux</a></span> (<span class="id">d</span>: <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.A">A</a></span>) : <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.Q">Q</a></span> <span class="id">d</span> -&gt; <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Delay.html#now">now</a></span> <span class="id">v</span> =&gt; <span class="kwd">fun</span> <span class="id">SAFE</span> =&gt; <span class="id"><a href="CDF.Delay.html#later">later</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.BIND.f">f</a></span> <span class="id">v</span> (<span class="id"><a href="CDF.Delay.html#safe_inv_now">safe_inv_now</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">SAFE</span>)))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Delay.html#later">later</a></span> <span class="id">d</span> =&gt; <span class="kwd">fun</span> <span class="id">SAFE</span> =&gt; <span class="id"><a href="CDF.Delay.html#later">later</a></span> (<span class="id">bind_aux</span> <span class="id">d</span> (<span class="id"><a href="CDF.Delay.html#safe_inv_later">safe_inv_later</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">SAFE</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="HDiv.safe_bind_aux">safe_bind_aux</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">d</span>: <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.A">A</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.Q">Q</a></span> <span class="id">d</span>), <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.R">R</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.bind_aux">bind_aux</a></span> <span class="id">d</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof234')">Proof.</div>
<div class="proofscript" id="proof234">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">COH</span>; <span class="tactic">intros</span>. <span class="id">unroll_delay</span> (<span class="id"><a href="CDF.Monads.html#HDiv.bind_aux">bind_aux</a></span> <span class="id">d</span> <span class="id">s</span>); <span class="tactic">destruct</span> <span class="id">d</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="CDF.Monads.html#HDiv.BIND.f">f</a></span> <span class="id">a0</span> (<span class="id"><a href="CDF.Delay.html#safe_inv_now">safe_inv_now</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.Q">Q</a></span> <span class="id">a0</span> <span class="id">s</span>)) <span class="kwd">as</span> (<span class="id">d1</span> &amp; <span class="id">s1</span>); <span class="id">cbn</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">COH</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.bind">bind</a></span> : <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.P">P</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.B">B</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="kwd">let</span> '(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">d</span> <span class="id">s</span>) := <span class="id"><a href="CDF.Monads.html#HDiv.BIND.a">a</a></span> <span class="id">p</span> <span class="kwd">in</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="CDF.Monads.html#HDiv.bind_aux">bind_aux</a></span> <span class="id">d</span> <span class="id">s</span>) (<span class="id"><a href="CDF.Monads.html#HDiv.safe_bind_aux">safe_bind_aux</a></span> <span class="id">d</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HDiv.BIND">BIND</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.implies">implies</a></span> (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) := <span class="id">P</span> -&gt; <span class="id">P</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HDiv.consequence_pre">consequence_pre</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="id"><a href="CDF.Monads.html#HDiv.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span>' =&gt; <span class="id">m</span> (<span class="id">IMP</span> <span class="id">p</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HDiv.consequence_post">consequence_post</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HDiv.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id">m</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof235')">Next Obligation.</div>
<div class="proofscript" id="proof235">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m</span> <span class="id">p</span>); <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Delay.html#safe_consequence">safe_consequence</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">A specific operation of the DIV monad: a <span class="bracket"><span class="tactic">repeat</span>...<span class="id">until</span></span> unbounded loop.
   <span class="bracket"><span class="id">iter</span> <span class="id">f</span> <span class="id">x</span></span> is such that
<ul>
<li>
 <span class="bracket"><span class="id">iter</span> <span class="id">f</span> <span class="id">x</span> = <span class="id">y</span></span> if <span class="bracket"><span class="id">f</span> <span class="id">x</span></span> terminates with <span class="bracket"><span class="id">inr</span> <span class="id">y</span></span>
</li>
<li>
 <span class="bracket"><span class="id">iter</span> <span class="id">f</span> <span class="id">x</span> = <span class="id">iter</span> <span class="id">f</span> <span class="id">x</span>'</span> if <span class="bracket"><span class="id">f</span> <span class="id">x</span></span> terminates with <span class="bracket"><span class="id">inl</span> <span class="id">x</span>'</span>.
</li>
</ul>
</div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="HDiv.ITER">ITER</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HDiv.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> <span class="id">B</span>).<br/>
<br/>
<span class="kwd">Let</span> <span class="id"><a name="HDiv.ITER.R">R</a></span> : <span class="id"><a href="CDF.Monads.html#HDiv.POST">POST</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span> + <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span>) := <span class="kwd">fun</span> <span class="id">ab</span> =&gt; <span class="kwd">match</span> <span class="id">ab</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.Monads.html#HDiv.ITER.P">P</a></span> <span class="id">a</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.Monads.html#HDiv.ITER.Q">Q</a></span> <span class="id">b</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Context</span> (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">a</span>: <span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span>), <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.P">P</a></span> <span class="id">a</span>) (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span> + <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span>) <span class="id"><a href="CDF.Monads.html#HDiv.ITER.R">R</a></span>).<br/>
<br/>
<span class="kwd">CoFixpoint</span> <span class="id"><a name="HDiv.iter_aux">iter_aux</a></span> (<span class="id">d</span>: <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span> + <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span>)) : <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.R">R</a></span> <span class="id">d</span> -&gt; <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">d</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Delay.html#now">now</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">a</span>) =&gt; <span class="kwd">fun</span> <span class="id">SAFE</span> =&gt; <span class="kwd">let</span> '(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">d</span>' <span class="id">s</span>') := <span class="id"><a href="CDF.Monads.html#HDiv.ITER.f">f</a></span> <span class="id">a</span> (<span class="id"><a href="CDF.Delay.html#safe_inv_now">safe_inv_now</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">SAFE</span>) <span class="kwd">in</span> <span class="id"><a href="CDF.Delay.html#later">later</a></span> (<span class="id">iter_aux</span> <span class="id">d</span>' <span class="id">s</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Delay.html#now">now</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">b</span>) =&gt; <span class="kwd">fun</span> <span class="id">SAFE</span> =&gt; <span class="id"><a href="CDF.Delay.html#now">now</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Delay.html#later">later</a></span> <span class="id">d</span> =&gt; <span class="kwd">fun</span> <span class="id">SAFE</span> =&gt; <span class="id"><a href="CDF.Delay.html#later">later</a></span> (<span class="id">iter_aux</span> <span class="id">d</span> (<span class="id"><a href="CDF.Delay.html#safe_inv_later">safe_inv_later</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">SAFE</span>))<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="HDiv.safe_iter_aux">safe_iter_aux</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">d</span>: <span class="id"><a href="CDF.Delay.html#delay">delay</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span> + <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span>)) (<span class="id">s</span>: <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.R">R</a></span> <span class="id">d</span>), <span class="id"><a href="CDF.Delay.html#safe">safe</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.Q">Q</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.iter_aux">iter_aux</a></span> <span class="id">d</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof236')">Proof.</div>
<div class="proofscript" id="proof236">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">COINDHYP</span>; <span class="tactic">intros</span>. <span class="id">unroll_delay</span> (<span class="id"><a href="CDF.Monads.html#HDiv.iter_aux">iter_aux</a></span> <span class="id">d</span> <span class="id">s</span>); <span class="tactic">destruct</span> <span class="id">d</span> <span class="kwd">as</span> [[<span class="id">a</span> | <span class="id">b</span>] | <span class="id">d</span>].<br/>
- <span class="tactic">destruct</span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.f">f</a></span> <span class="kwd">as</span> [<span class="id">ab</span>' <span class="id">s</span>']. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">COINDHYP</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Delay.html#safe_inv_now">safe_inv_now</a></span> <span class="kwd">in</span> <span class="id">s</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
- <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">COINDHYP</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HDiv.iter">iter</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Monads.html#HDiv.ITER.A">A</a></span>) : <span class="id"><a href="CDF.Monads.html#HDiv.M">M</a></span> (<span class="id"><a href="CDF.Monads.html#HDiv.ITER.P">P</a></span> <span class="id">x</span>) <span class="id"><a href="CDF.Monads.html#HDiv.ITER.B">B</a></span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER.Q">Q</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">p</span> =&gt; <span class="id"><a href="CDF.Monads.html#HDiv.iter_aux">iter_aux</a></span> (<span class="id"><a href="CDF.Delay.html#now">now</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">x</span>)) <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof237')">Next Obligation.</div>
<div class="proofscript" id="proof237">
&nbsp;&nbsp;<span class="id">constructor</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof238')">Next Obligation.</div>
<div class="proofscript" id="proof238">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Monads.html#HDiv.safe_iter_aux">safe_iter_aux</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HDiv.ITER">ITER</a></span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HDiv">HDiv</a></span>.<br/>
<br/>
<h2> The Hoare monad for mutable state </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="HST">HST</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#HOAREMONAD">HOAREMONAD</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Separation</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.PRE">PRE</a></span> := <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.M">M</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id">P</span> <span class="id">h</span> -&gt; { <span class="id">a_h</span> : <span class="id">A</span> * <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> | <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">a_h</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">a_h</span>) }.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HST.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>) (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">A</span> <span class="id">Q</span><br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">h</span> <span class="id">_</span> =&gt; (<span class="id">v</span>, <span class="id">h</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HST.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span>: <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">B</span> <span class="id">R</span>) : <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">B</span> <span class="id">R</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> <span class="id">p</span> =&gt; <span class="kwd">let</span> '(<span class="id">v</span>, <span class="id">h</span>') := <span class="id">a</span> <span class="id">h</span> <span class="id">p</span> <span class="kwd">in</span> <span class="id">f</span> <span class="id">v</span> <span class="id">h</span>' <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof239')">Next Obligation.</div>
<div class="proofscript" id="proof239">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">a</span> <span class="id">h</span> <span class="id">p</span>) <span class="kwd">as</span> [[<span class="id">v1</span> <span class="id">h1</span>] <span class="id">p1</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">inv</span> <span class="id">Heq_anonymous</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.implies">implies</a></span> (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) := <span class="id">P</span> --&gt;&gt; <span class="id">P</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.consequence_pre">consequence_pre</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="id"><a href="CDF.Monads.html#HST.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> <span class="id">p</span>' =&gt; <span class="id">m</span> <span class="id">h</span> (<span class="id">IMP</span> <span class="id">h</span> <span class="id">p</span>').<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HST.consequence_post">consequence_post</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HST.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> <span class="id">p</span> =&gt; <span class="id">m</span> <span class="id">h</span> <span class="id">p</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof240')">Next Obligation.</div>
<div class="proofscript" id="proof240">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m</span> <span class="id">h</span> <span class="id">p</span>) <span class="kwd">as</span> [[<span class="id">v</span> <span class="id">h</span>'] <span class="id">q</span>]; <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id">IMP</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HST.consequence">consequence</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HST.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HST.POST">POST</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IMP1</span>: <span class="id"><a href="CDF.Monads.html#HST.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">IMP2</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HST.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#HST.consequence_pre">consequence_pre</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IMP1</span> (<span class="id"><a href="CDF.Monads.html#HST.consequence_post">consequence_post</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IMP2</span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HST.get">get</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) : <br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span> <span class="id">R</span>, <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> (<span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ** <span class="id">R</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> (<span class="kwd">fun</span> <span class="id">v</span>' =&gt; (<span class="id">v</span>' = <span class="id">v</span>) //\\ <span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ** <span class="id">R</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">v</span> <span class="id">R</span> <span class="id">h</span> <span class="id">p</span> =&gt; <span class="kwd">match</span> <span class="id">h</span> <span class="id">l</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>' =&gt; (<span class="id">v</span>', <span class="id">h</span>) | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">_</span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof241')">Next Obligation.</div>
<div class="proofscript" id="proof241">
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">p1</span> &amp; <span class="id">p2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">U</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">p1</span>, <span class="id"><a href="CDF.Separation.html#hupdate_same">hupdate_same</a></span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof242')">Next Obligation.</div>
<div class="proofscript" id="proof242">
&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">p1</span> &amp; <span class="id">p2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">U</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id">p1</span>, <span class="id"><a href="CDF.Separation.html#hupdate_same">hupdate_same</a></span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>.<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="tactic">set</span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">R</span>, <span class="id"><a href="CDF.Monads.html#HST.M">M</a></span> (<span class="id"><a href="CDF.Separation.html#valid">valid</a></span> <span class="id">l</span> ** <span class="id">R</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span> ** <span class="id">R</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span> <span class="id">h</span> <span class="id">p</span> =&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof243')">Next Obligation.</div>
<div class="proofscript" id="proof243">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span> <span class="kwd">as</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">p1</span> &amp; <span class="id">p2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>). <span class="tactic">destruct</span> <span class="id">p1</span> <span class="kwd">as</span> (<span class="id">v0</span> &amp; <span class="id">p1</span>). <span class="tactic">rewrite</span> <span class="id">p1</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>), <span class="id">h2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">x</span>; <span class="id">cbn</span>. <span class="id">specialize</span> (<span class="id">D</span> <span class="id">x</span>); <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">D</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">x</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">U</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">x</span>. <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">x</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HST">HST</a></span>.<br/>
<br/>
<h2> The Hoare monad for mutable state in separation logic style </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="HSep">HSep</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Separation</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.PRE">PRE</a></span> := <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.M">M</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">R</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>), <span class="id"><a href="CDF.Monads.html#HST.M">HST.M</a></span> (<span class="id">P</span> ** <span class="id">R</span>) <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">R</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>) (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.ret">HST.ret</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">R</span>) <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id">P</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) (<span class="id">Q</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) (<span class="id">R</span>: <span class="id">B</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>)<br/>
&nbsp;&nbsp;(<span class="id">a</span>: <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> (<span class="id">Q</span> <span class="id">v</span>) <span class="id">B</span> <span class="id">R</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">B</span> <span class="id">R</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">F</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.bind">HST.bind</a></span> (<span class="id">P</span> ** <span class="id">F</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">F</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">R</span> <span class="id">v</span> ** <span class="id">F</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span> <span class="id">F</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">f</span> <span class="id">v</span> <span class="id">F</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.implies">implies</a></span> (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) := <span class="id">P</span> --&gt;&gt; <span class="id">P</span>'.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HSep.consequence_pre">consequence_pre</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="id"><a href="CDF.Monads.html#HSep.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.consequence_pre">HST.consequence_pre</a></span> (<span class="id">P</span> ** <span class="id">R</span>) (<span class="id">P</span>' ** <span class="id">R</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">R</span>) <span class="id">_</span> (<span class="id">m</span> <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof244')">Next Obligation.</div>
<div class="proofscript" id="proof244">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#sepconj_imp_l">sepconj_imp_l</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HSep.consequence_post">consequence_post</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>) (<span class="id">IMP</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HSep.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.consequence_post">HST.consequence_post</a></span> (<span class="id">P</span> ** <span class="id">R</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">R</span>) (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span>' <span class="id">v</span> ** <span class="id">R</span>) <span class="id">_</span> (<span class="id">m</span> <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof245')">Next Obligation.</div>
<div class="proofscript" id="proof245">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#sepconj_imp_l">sepconj_imp_l</a></span>. <span class="tactic">apply</span> <span class="id">IMP</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="HSep.consequence">consequence</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span> <span class="id">P</span>': <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">Q</span> <span class="id">Q</span>': <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IMP1</span>: <span class="id"><a href="CDF.Monads.html#HSep.implies">implies</a></span> <span class="id">P</span>' <span class="id">P</span>) (<span class="id">IMP2</span>: <span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HSep.implies">implies</a></span> (<span class="id">Q</span> <span class="id">v</span>) (<span class="id">Q</span>' <span class="id">v</span>)) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span>' <span class="id">A</span> <span class="id">Q</span>' :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#HSep.consequence_pre">consequence_pre</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IMP1</span> (<span class="id"><a href="CDF.Monads.html#HSep.consequence_post">consequence_post</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">IMP2</span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HSep.frame">frame</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">R</span>: <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">P</span>: <span class="id"><a href="CDF.Monads.html#HSep.PRE">PRE</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#HSep.POST">POST</a></span> <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> <span class="id">P</span> <span class="id">A</span> <span class="id">Q</span>) : <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> (<span class="id">P</span> ** <span class="id">R</span>) <span class="id">A</span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> ** <span class="id">R</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span>' =&gt; <span class="id"><a href="CDF.Monads.html#HST.consequence">HST.consequence</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id">m</span> (<span class="id">R</span> ** <span class="id">R</span>')).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof246')">Next Obligation.</div>
<div class="proofscript" id="proof246">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="id">hnf</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof247')">Next Obligation.</div>
<div class="proofscript" id="proof247">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="id">hnf</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="HSep.get">get</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) : <br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>, <span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> (<span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> (<span class="kwd">fun</span> <span class="id">v</span>' =&gt; (<span class="id">v</span>' = <span class="id">v</span>) //\\ <span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">v</span> <span class="id">R</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.consequence_post">HST.consequence_post</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> (<span class="id"><a href="CDF.Monads.html#HST.get">HST.get</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof248')">Next Obligation.</div>
<div class="proofscript" id="proof248">
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#lift_pureconj">lift_pureconj</a></span>. <span class="id">hnf</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="tactic">set</span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#HSep.M">M</a></span> (<span class="id"><a href="CDF.Separation.html#valid">valid</a></span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">R</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.set">HST.set</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">R</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#HSep">HSep</a></span>.<br/>
<br/>
<h1> Dijkstra monads </h1>
<br/>
<h2> The generic interface </h2>
<br/>
<span class="kwd">Module</span> <span class="kwd">Type</span> <span class="id"><a name="DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.PRE">PRE</a></span>: <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.POST">POST</a></span>: <span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>), <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Definition</span> <span class="id"><a name="DIJKSTRAMONAD.TRANSF">TRANSF</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.POST">POST</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.PRE">PRE</a></span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.M">M</a></span>: <span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">A</span>), <span class="kwd">Type</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.RET">RET</a></span>: <span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.ret">ret</a></span>: <span class="kwd">forall</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.RET">RET</a></span> <span class="id">v</span>).<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.BIND">BIND</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">B</span>), <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">B</span>.<br/>
&nbsp;&nbsp;<span class="kwd">Parameter</span> <span class="id"><a name="DIJKSTRAMONAD.bind">bind</a></span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.TRANSF">TRANSF</a></span> <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.M">M</a></span> <span class="id">A</span> <span class="id">W1</span> -&gt; (<span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.M">M</a></span> <span class="id">B</span> (<span class="id">W2</span> <span class="id">v</span>)) -&gt; <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.M">M</a></span> <span class="id">B</span> (<span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span>).<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
<br/>
<h2> The Dijkstra monad of pure computations </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="DPure">DPure</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.PRE">PRE</a></span> := <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DPure.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.TRANSF">TRANSF</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id"><a href="CDF.Monads.html#DPure.POST">POST</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DPure.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.M">M</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Q</span>, <span class="id">W</span> <span class="id">Q</span> -&gt; { <span class="id">r</span>: <span class="id">A</span> | <span class="id">Q</span> <span class="id">r</span>}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.RET">RET</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">A</span> := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DPure.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DPure.RET">RET</a></span> <span class="id">v</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">v</span> <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.BIND">BIND</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">B</span>) : <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">W1</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DPure.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DPure.TRANSF">TRANSF</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#DPure.M">M</a></span> <span class="id">A</span> <span class="id">W1</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DPure.M">M</a></span> <span class="id">B</span> (<span class="id">W2</span> <span class="id">v</span>)) : <span class="id"><a href="CDF.Monads.html#DPure.M">M</a></span> <span class="id">B</span> (<span class="id"><a href="CDF.Monads.html#DPure.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="kwd">let</span> '(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">x</span> <span class="id">q</span>) := <span class="id">m</span> <span class="id">_</span> <span class="id">p</span> <span class="kwd">in</span> <span class="id">f</span> <span class="id">x</span> <span class="id">Q</span> <span class="id">q</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#DPure">DPure</a></span>.<br/>
<br/>
<h2> The Dijkstra monad of diverging computations </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="DDiv">DDiv</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.PRE">PRE</a></span> := <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DDiv.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.TRANSF">TRANSF</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id"><a href="CDF.Monads.html#DDiv.POST">POST</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DDiv.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.M">M</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> := <span class="kwd">forall</span> <span class="id">Q</span>, <span class="id"><a href="CDF.Monads.html#HDiv.M">HDiv.M</a></span> (<span class="id">W</span> <span class="id">Q</span>) <span class="id">A</span> <span class="id">Q</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.RET">RET</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">A</span> := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DDiv.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DDiv.RET">RET</a></span> <span class="id">v</span>) := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id"><a href="CDF.Monads.html#HDiv.ret">HDiv.ret</a></span> <span class="id">Q</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.BIND">BIND</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">B</span>) : <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">W1</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DDiv.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DDiv.TRANSF">TRANSF</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#DDiv.M">M</a></span> <span class="id">A</span> <span class="id">W1</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DDiv.M">M</a></span> <span class="id">B</span> (<span class="id">W2</span> <span class="id">v</span>)) : <span class="id"><a href="CDF.Monads.html#DDiv.M">M</a></span> <span class="id">B</span> (<span class="id"><a href="CDF.Monads.html#DDiv.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id"><a href="CDF.Monads.html#HDiv.bind">HDiv.bind</a></span> (<span class="id"><a href="CDF.Monads.html#DDiv.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span> <span class="id">Q</span>) (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>) <span class="id">Q</span> (<span class="id">m</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>)) (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span> <span class="id">x</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#DDiv">DDiv</a></span>.<br/>
<br/>
<div class="doc">Lifting pure computations to the <span class="bracket"><span class="id">DDiv</span></span> monad. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DIV_of_PURE">DIV_of_PURE</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#TRANSF">DDiv.TRANSF</a></span> <span class="id">A</span> := <span class="id">W</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="div_of_pure">div_of_pure</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} {<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>} (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#M">DPure.M</a></span> <span class="id">A</span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CDF.Monads.html#M">DDiv.M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DIV_of_PURE">DIV_of_PURE</a></span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="kwd">let</span> '(<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> <span class="id">v</span> <span class="id">q</span>) := <span class="id">m</span> <span class="id">Q</span> <span class="id">p</span> <span class="kwd">in</span> (<span class="id"><a href="CDF.Monads.html#ret">DDiv.ret</a></span> <span class="id">v</span> <span class="id">Q</span> <span class="id">q</span>).<br/>
<br/>
<h2> The Dijkstra monad of mutable state </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="DST">DST</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Separation</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.PRE">PRE</a></span> := <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DST.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.TRANSF">TRANSF</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id"><a href="CDF.Monads.html#DST.POST">POST</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DST.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.M">M</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> := <span class="kwd">forall</span> <span class="id">Q</span>, <span class="id"><a href="CDF.Monads.html#HST.M">HST.M</a></span> (<span class="id">W</span> <span class="id">Q</span>) <span class="id">A</span> <span class="id">Q</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.RET">RET</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">A</span> := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DST.RET">RET</a></span> <span class="id">v</span>) := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.ret">HST.ret</a></span> <span class="id">Q</span> <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.BIND">BIND</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">B</span>) : <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">W1</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id">A</span> <span class="id">W1</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id">B</span> (<span class="id">W2</span> <span class="id">v</span>)) : <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id">B</span> (<span class="id"><a href="CDF.Monads.html#DST.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id"><a href="CDF.Monads.html#HST.bind">HST.bind</a></span> (<span class="id"><a href="CDF.Monads.html#DST.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span> <span class="id">Q</span>) (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>) <span class="id">Q</span> (<span class="id">m</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">W2</span> <span class="id">x</span> <span class="id">Q</span>)) (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span> <span class="id">x</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.GET">GET</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) : <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> (<span class="id">h</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) =&gt; <span class="kwd">match</span> <span class="id">h</span> <span class="id">l</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; <span class="id">Q</span> <span class="id">v</span> <span class="id">h</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="DST.get">get</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) : <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> (<span class="id"><a href="CDF.Monads.html#DST.GET">GET</a></span> <span class="id">l</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">h</span> <span class="id">p</span> =&gt; <span class="kwd">match</span> <span class="id">h</span> <span class="id">l</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> =&gt; (<span class="id">v</span>, <span class="id">h</span>) | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id">_</span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof249')">Next Obligation.</div>
<div class="proofscript" id="proof249">
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heq_anonymous</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof250')">Next Obligation.</div>
<div class="proofscript" id="proof250">
&nbsp;&nbsp;<span class="id">exfalso</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">Heq_anonymous</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DST.SET">SET</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.Monads.html#DST.TRANSF">TRANSF</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> (<span class="id">h</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) =&gt; <span class="id">h</span> <span class="id">l</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> /\ <span class="id">Q</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span> (<span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="tactic">set</span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.Monads.html#DST.M">M</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> (<span class="id"><a href="CDF.Monads.html#DST.SET">SET</a></span> <span class="id">l</span> <span class="id">v</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">h</span> <span class="id">p</span> =&gt; (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>, <span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof251')">Next Obligation.</div>
<div class="proofscript" id="proof251">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">p</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#DST">DST</a></span>.<br/>
<br/>
<div class="doc">Lifting pure computations to the <span class="bracket"><span class="id">DST</span></span> monad. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ST_of_PURE">ST_of_PURE</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#TRANSF">DST.TRANSF</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#POST">DST.POST</a></span> <span class="id">A</span>) <span class="id">h</span> =&gt; <span class="id">W</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Q</span> <span class="id">a</span> <span class="id">h</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="st_of_pure">st_of_pure</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} {<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>} (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#M">DPure.M</a></span> <span class="id">A</span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CDF.Monads.html#M">DST.M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#ST_of_PURE">ST_of_PURE</a></span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">Q</span> <span class="id">h</span> <span class="id">p</span> =&gt; (<span class="id">m</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Q</span> <span class="id">a</span> <span class="id">h</span>) <span class="id">p</span>, <span class="id">h</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof252')">Next Obligation.</div>
<div class="proofscript" id="proof252">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> The Dijkstra monad of exceptions </h2>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="exn">exn</a></span>: <span class="kwd">Type</span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="DExn">DExn</a></span> &lt;: <span class="id"><a href="CDF.Monads.html#DIJKSTRAMONAD">DIJKSTRAMONAD</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.PRE">PRE</a></span> := <span class="kwd">Prop</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.POST">POST</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id">A</span> + <span class="id"><a href="CDF.Monads.html#exn">exn</a></span> -&gt; <span class="id"><a href="CDF.Monads.html#DExn.PRE">PRE</a></span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.TRANSF">TRANSF</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) := <span class="id"><a href="CDF.Monads.html#DExn.POST">POST</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DExn.PRE">PRE</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.M">M</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">A</span>) : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Q</span>, <span class="id">W</span> <span class="id">Q</span> -&gt; { <span class="id">r</span>: <span class="id">A</span> + <span class="id"><a href="CDF.Monads.html#exn">exn</a></span> | <span class="id">Q</span> <span class="id">r</span>}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.RET">RET</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">A</span> := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">v</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.ret">ret</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">v</span>: <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#DExn.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DExn.RET">RET</a></span> <span class="id">v</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">v</span>) <span class="id">p</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.BIND">BIND</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">B</span>) : <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">W1</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="kwd">match</span> <span class="id">x</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">v</span> =&gt; <span class="id">W2</span> <span class="id">v</span> <span class="id">Q</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span> =&gt; <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span>) <span class="kwd">end</span>).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="DExn.bind">bind</a></span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>} (<span class="id">W1</span>: <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">A</span>) (<span class="id">W2</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#DExn.M">M</a></span> <span class="id">A</span> <span class="id">W1</span>) (<span class="id">f</span>: <span class="kwd">forall</span> (<span class="id">v</span>: <span class="id">A</span>), <span class="id"><a href="CDF.Monads.html#DExn.M">M</a></span> <span class="id">B</span> (<span class="id">W2</span> <span class="id">v</span>)) : <span class="id"><a href="CDF.Monads.html#DExn.M">M</a></span> <span class="id">B</span> (<span class="id"><a href="CDF.Monads.html#DExn.BIND">BIND</a></span> <span class="id">W1</span> <span class="id">W2</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="kwd">match</span> <span class="id">m</span> <span class="id">_</span> <span class="id">p</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">v</span> =&gt; <span class="id">f</span> <span class="id">v</span> <span class="id">Q</span> <span class="id">_</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof253')">Next Obligation.</div>
<div class="proofscript" id="proof253">
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">q</span>]. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="tactic">subst</span> <span class="id">r</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<div class="toggleproof" onclick="toggleDisplay('proof254')">Next Obligation.</div>
<div class="proofscript" id="proof254">
&nbsp;&nbsp;<span class="tactic">red</span> <span class="kwd">in</span> <span class="id">p</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [<span class="id">r</span> <span class="id">q</span>]. <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="tactic">subst</span> <span class="id">r</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.RAISE">RAISE</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">e</span>: <span class="id"><a href="CDF.Monads.html#exn">exn</a></span>) : <span class="id"><a href="CDF.Monads.html#DExn.TRANSF">TRANSF</a></span> <span class="id">A</span> := <span class="kwd">fun</span> <span class="id">Q</span> =&gt; <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DExn.raise">raise</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">e</span>: <span class="id"><a href="CDF.Monads.html#exn">exn</a></span>) : <span class="id"><a href="CDF.Monads.html#DExn.M">M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#DExn.RAISE">RAISE</a></span> <span class="id">A</span> <span class="id">e</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#exist">exist</a></span> <span class="id">_</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">e</span>) <span class="id">p</span>.<br/>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Monads.html#DExn">DExn</a></span>.<br/>
<br/>
<div class="doc">Lifting pure computations to the <span class="bracket"><span class="id">DExn</span></span> monad. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="EXN_of_PURE">EXN_of_PURE</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>) : <span class="id"><a href="CDF.Monads.html#TRANSF">DExn.TRANSF</a></span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Monads.html#POST">DExn.POST</a></span> <span class="id">A</span>) =&gt; <span class="id">W</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">a</span>)).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="exn_of_pure">exn_of_pure</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} {<span class="id">W</span>: <span class="id"><a href="CDF.Monads.html#TRANSF">DPure.TRANSF</a></span> <span class="id">A</span>} (<span class="id">m</span>: <span class="id"><a href="CDF.Monads.html#M">DPure.M</a></span> <span class="id">A</span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;: <span class="id"><a href="CDF.Monads.html#M">DExn.M</a></span> <span class="id">A</span> (<span class="id"><a href="CDF.Monads.html#EXN_of_PURE">EXN_of_PURE</a></span> <span class="id">W</span>)<br/>
&nbsp;&nbsp;:= <span class="kwd">fun</span> <span class="id">Q</span> <span class="id">p</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Specif.html#proj1_sig">proj1_sig</a></span> (<span class="id">m</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">a</span>)) <span class="id">p</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof255')">Next Obligation.</div>
<div class="proofscript" id="proof255">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
