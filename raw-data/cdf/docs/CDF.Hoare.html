
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Hoare</title>
<meta name="description" content="Documentation of Coq module Hoare" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Hoare</h1>
<div class="coq">
<div class="doc">Hoare logic. </div>
<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Arith.Arith.html">Arith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Program.Equality.html">Program.Equality</a></span>.<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span>.<br/>
<span class="id">From</span> <span class="id">CDF</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="CDF.Sequences.html">Sequences</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">inv</span> <span class="id">H</span> := <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">clear</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
<br/>
<h1> 1.  The IMP language </h1>
<br/>
<h2> 1.1. Arithmetic expressions </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="ident">ident</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string">string</a></span>.<br/>
<br/>
<div class="doc">The abstract syntax: an arithmetic expression is either... </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="aexp">aexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="CONST">CONST</a></span> (<span class="id">n</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>)                       <span class="docright">(* a constant, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="VAR">VAR</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>)                     <span class="docright">(* a variable, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="PLUS">PLUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>)         <span class="docright">(* a sum of two expressions, or  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="MINUS">MINUS</a></span> (<span class="id">a1</span>: <span class="id">aexp</span>) (<span class="id">a2</span>: <span class="id">aexp</span>).       <span class="docright">(* a difference of two expressions  *)</span><br/>
<br/>
<div class="doc">The denotational semantics: an evaluation function that computes
  the integer value denoted by an expression.  This function is
  parameterized by a store <span class="bracket"><span class="id">s</span></span> that associates values to variables. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="store">store</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="aeval">aeval</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span> =&gt; <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">x</span> =&gt; <span class="id">s</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#PLUS">PLUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> + <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#MINUS">MINUS</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id">aeval</span> <span class="id">a1</span> <span class="id">s</span> - <span class="id">aeval</span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> 1.2. Boolean expressions </h2>
<br/>
<div class="doc">The IMP language has conditional statements (if/then/else) and
  loops.  They are controlled by expressions that evaluate to Boolean
  values.  Here is the abstract syntax of Boolean expressions. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="bexp">bexp</a></span> : <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="TRUE">TRUE</a></span>                              <span class="docright">(* always true  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="FALSE">FALSE</a></span>                             <span class="docright">(* always false  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="EQUAL">EQUAL</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>)       <span class="docright">(* whether <span class="bracket"><span class="id">a1</span> = <span class="id">a2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="LESSEQUAL">LESSEQUAL</a></span> (<span class="id">a1</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>)   <span class="docright">(* whether <span class="bracket"><span class="id">a1</span> &lt;= <span class="id">a2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="NOT">NOT</a></span> (<span class="id">b1</span>: <span class="id">bexp</span>)                    <span class="docright">(* Boolean negation  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="AND">AND</a></span> (<span class="id">b1</span>: <span class="id">bexp</span>) (<span class="id">b2</span>: <span class="id">bexp</span>).        <span class="docright">(* Boolean conjunction  *)</span><br/>
<br/>
<div class="doc">Just like arithmetic expressions evaluate to integers,
  Boolean expressions evaluate to Boolean values <span class="bracket"><span class="id">true</span></span> or <span class="bracket"><span class="id">false</span></span>. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="beval">beval</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#TRUE">TRUE</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#FALSE">FALSE</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span> =? <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a1</span> <span class="id">s</span> &lt;=? <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> <span class="id">b1</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#negb">negb</a></span> (<span class="id">beval</span> <span class="id">b1</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#AND">AND</a></span> <span class="id">b1</span> <span class="id">b2</span> =&gt; <span class="id">beval</span> <span class="id">b1</span> <span class="id">s</span> &amp;&amp; <span class="id">beval</span> <span class="id">b2</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">There are many useful derived forms. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="NOTEQUAL">NOTEQUAL</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.Hoare.html#EQUAL">EQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="GREATEREQUAL">GREATEREQUAL</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a2</span> <span class="id">a1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="GREATER">GREATER</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> <span class="id">a1</span> <span class="id">a2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="LESS">LESS</a></span> (<span class="id">a1</span> <span class="id">a2</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.Hoare.html#GREATER">GREATER</a></span> <span class="id">a2</span> <span class="id">a1</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="OR">OR</a></span> (<span class="id">b1</span> <span class="id">b2</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span> := <span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> (<span class="id"><a href="CDF.Hoare.html#AND">AND</a></span> (<span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> <span class="id">b1</span>) (<span class="id"><a href="CDF.Hoare.html#NOT">NOT</a></span> <span class="id">b2</span>)).<br/>
<br/>
<h2> 1.3. Commands </h2>
<br/>
<div class="doc">To complete the definition of the IMP language, here is the
  abstract syntax of commands, also known as statements. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="com">com</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="SKIP">SKIP</a></span>                                     <span class="docright">(* do nothing  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ASSIGN">ASSIGN</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>)              <span class="docright">(* assignment: <span class="bracket"><span class="id">v</span> := <span class="id">a</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="SEQ">SEQ</a></span> (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>)                  <span class="docright">(* sequence: <span class="bracket"><span class="id">c1</span>; <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="IFTHENELSE">IFTHENELSE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>) <span class="docright">(* conditional: <span class="bracket"><span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WHILE">WHILE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>)                <span class="docright">(* loop: <span class="bracket"><span class="id">while</span> <span class="id">b</span> <span class="tactic">do</span> <span class="id">c1</span> <span class="id">done</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="ASSERT">ASSERT</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>)                         <span class="docright">(* assertion (error if false)  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="HAVOC">HAVOC</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>).                        <span class="docright">(* nondeterministic assignment  *)</span><br/>
<br/>
<div class="doc">We can write <span class="bracket"><span class="id">c1</span> ;; <span class="id">c2</span></span> instead of <span class="bracket"><span class="id">SEQ</span> <span class="id">c1</span> <span class="id">c2</span></span>, it is easier on the eyes. </div>
<br/>
<span class="kwd">Infix</span> ";;" := <span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> (<span class="tactic">at</span> <span class="id">level</span> 80, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">Reduction semantics. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="update">update</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="id"><a href="CDF.Hoare.html#store">store</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span> <span class="kwd">then</span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">s</span> <span class="id">y</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="update_same">update_same</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>, (<span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>) <span class="id">x</span> = <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#update">update</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="update_other">update_other</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span> <span class="id">y</span>, <span class="id">x</span> &lt;&gt; <span class="id">y</span> -&gt; (<span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>) <span class="id">y</span> = <span class="id">s</span> <span class="id">y</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Proof.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#update">update</a></span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The relation <span class="bracket"> <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') </span>, written <span class="bracket"> <span class="id">c</span> / <span class="id">s</span> --&gt; <span class="id">c</span>' / <span class="id">s</span>' </span>
    in the lectures, defines a basic reduction, that is, the first
    computation step when executing command <span class="bracket"><span class="id">c</span></span> in initial memory
    state <span class="bracket"><span class="id">s</span></span>.
    <span class="bracket"><span class="id">s</span>'</span> is the memory state "after" this computation step.
    <span class="bracket"><span class="id">c</span>'</span> is a command that represent all the computations that remain
    to be performed later.
    The reduction relation is presented as a Coq inductive predicate,
    with one case (one "constructor") for each reduction rule.
</div>
<br/>
<span class="kwd">Inductive</span> <span class="tactic">red</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span> * <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#com">com</a></span> * <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_assign">red_assign</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_done">red_seq_done</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>, <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_seq_step">red_seq_step</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c</span> <span class="id">s1</span> <span class="id">c2</span> <span class="id">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id">c1</span>, <span class="id">s1</span>) (<span class="id">c2</span>, <span class="id">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c</span>, <span class="id">s1</span>) (<span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> <span class="id">c2</span> <span class="id">c</span>, <span class="id">s2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_ifthenelse">red_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>, <span class="id">s</span>) ((<span class="kwd">if</span> <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>), <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_done">red_while_done</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span>, <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_while_loop">red_while_loop</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> <span class="id">c</span> (<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>), <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_havoc">red_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">s</span> <span class="id">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span>, <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">n</span> <span class="id">s</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a name="red_assert">red_assert</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span> (<span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span>, <span class="id">s</span>) (<span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span>, <span class="id">s</span>).<br/>
<br/>
<div class="doc">The predicate <span class="bracket"> <span class="id">error</span> <span class="id">c</span> <span class="id">s</span> </span> means that command <span class="bracket"><span class="id">c</span></span> started in state <span class="bracket"><span class="id">s</span></span>
    causes a run-time error.
    This is written <span class="bracket"> <span class="id">c</span> / <span class="id">s</span> --&gt; <span class="id">err</span> </span> in the lectures. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="error">error</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;| (<span class="id">c1</span> ;; <span class="id">c2</span>) =&gt; <span class="id">error</span> <span class="id">c1</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="terminated">terminated</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) : <span class="kwd">Prop</span> :=  <span class="id">c</span> = <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="terminates">terminates</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">s</span> <span class="id">s</span>': <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">c</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') /\ <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="goeswrong">goeswrong</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">c</span>' <span class="id">s</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') /\ <span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span>' <span class="id">s</span>'.<br/>
<br/>
<h1> 2.  Hoare logic </h1>
<br/>
<h2> 2.1.  Assertions on the values of variables </h2>
<br/>
<div class="doc">Hoare logic manipulates formulas / claims / assertions that "talk about"
    the values of the program variables.  A typical assertion is
    <span class="bracket">0 &lt;= <span class="id">x</span> /\ <span class="id">x</span> &lt;= <span class="id">y</span></span>, meaning "at this program point, the value of 
    variable <span class="bracket"><span class="id">x</span></span> is positive and less than or equal to the value of
    variable <span class="bracket"><span class="id">y</span></span>". </div>
<br/>
<div class="doc">In our Coq development, we represent assertions by Coq logical formulas
    (type <span class="bracket"><span class="kwd">Prop</span></span>) parameterized by the current store, which provides
    the values of the variables.
  
    For example, the assertion <span class="bracket">0 &lt;= <span class="id">x</span> /\ <span class="id">x</span> &lt;= <span class="id">y</span></span> above is represented
    by the Coq predicate <span class="bracket"><span class="kwd">fun</span> <span class="id">s</span> =&gt; 0 &lt;= <span class="id">s</span> "<span class="id">x</span>" /\ <span class="id">s</span> "<span class="id">x</span>" &lt;= <span class="id">s</span> "<span class="id">y</span>"</span>. </div>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assertion">assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">Here are some useful assertions.
    Conjunction and disjunction of two assertions. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aand">aand</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">P</span> <span class="id">s</span> /\ <span class="id">Q</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aor">aor</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">P</span> <span class="id">s</span> \/ <span class="id">Q</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">The assertion "arithmetic expression <span class="bracket"><span class="id">a</span></span> evaluates to value <span class="bracket"><span class="id">v</span></span>". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aequal">aequal</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> = <span class="id">v</span>.<br/>
<br/>
<div class="doc">The assertions "Boolean expression <span class="bracket"><span class="id">b</span></span> evaluates to true / to false". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="atrue">atrue</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="afalse">afalse</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<div class="doc">The assertion written "<span class="bracket"> <span class="id">P</span>[<span class="id">x</span> &lt;- <span class="id">a</span>] </span>" in the literature.
    Substituting <span class="bracket"><span class="id">a</span></span> for <span class="bracket"><span class="id">x</span></span> in <span class="bracket"><span class="id">P</span></span> amounts to evaluating <span class="bracket"><span class="id">P</span></span> in
    stores where the variable <span class="bracket"><span class="id">x</span></span> is equal to the value of expression <span class="bracket"><span class="id">a</span></span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aupdate">aupdate</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id">P</span> (<span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>).<br/>
<br/>
<div class="doc">Pointwise implication.  Unlike conjunction and disjunction, this is
    not a predicate over the store, just a Coq proposition. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aimp">aimp</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id">Q</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">Quantification. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aexists">aexists</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) =&gt; <span class="id">exists</span> (<span class="id">a</span>: <span class="id">A</span>), <span class="id">P</span> <span class="id">a</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aforall">aforall</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> (<span class="id">s</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>) =&gt; <span class="kwd">forall</span> (<span class="id">a</span>: <span class="id">A</span>), <span class="id">P</span> <span class="id">a</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">A few notations to improve legibility. </div>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>" := (<span class="id"><a href="CDF.Hoare.html#aimp">aimp</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 95, <span class="id">no</span> <span class="id">associativity</span>).<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> //\\ <span class="id">Q</span>" := (<span class="id"><a href="CDF.Hoare.html#aand">aand</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 80, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> \\// <span class="id">Q</span>" := (<span class="id"><a href="CDF.Hoare.html#aor">aor</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 75, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<h2> 2.2.  The rules of Hoare logic </h2>
<br/>
<div class="doc">Here are the base rules for weak Hoare logic.
    They define a relation <span class="bracket"> ⦃<span class="id">P</span>⦄ <span class="id">c</span> ⦃<span class="id">Q</span>⦄</span>, where
<ul>
<li>
   <span class="bracket"><span class="id">P</span></span> is the precondition, assumed to hold "before" executing <span class="bracket"><span class="id">c</span></span>;
</li>
<li>
   <span class="bracket"><span class="id">c</span></span> is the program or program fragment we reason about;
</li>
<li>
   <span class="bracket"><span class="id">Q</span></span> is the postcondition, guaranteed to hold "after" executing <span class="bracket"><span class="id">c</span></span>.
</li>
</ul>
  This is a "weak" logic, meaning that it does not guarantee termination
  of the command <span class="bracket"><span class="id">c</span></span>.  What is guaranteed is that if <span class="bracket"><span class="id">c</span></span> terminates,
  then its final store satisfies postcondition <span class="bracket"><span class="id">Q</span></span>. </div>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄" (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Hoare">Hoare</a></span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_skip">Hoare_skip</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> ⦃ <span class="id">P</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_assign">Hoare_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> ⦃ <span class="id">P</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_seq">Hoare_seq</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c1</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">Q</span> ⦄ <span class="id">c2</span> ⦃ <span class="id">R</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c1</span>;;<span class="id">c2</span> ⦃ <span class="id">R</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_ifthenelse">Hoare_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c1</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c2</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> ⦃ <span class="id">Q</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_while">Hoare_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">P</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> ⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_havoc">Hoare_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>) ⦄ <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> ⦃ <span class="id">Q</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_assert">Hoare_assert</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> ⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄<br/>
&nbsp;&nbsp;| <span class="id"><a name="Hoare_consequence">Hoare_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">P</span>' <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span>' ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span>' ⦄<br/>
<br/>
<span class="kwd">where</span> "⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄" := (<span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>).<br/>
<br/>
<div class="doc">Here are the rules for strong Hoare logic, defining strong triples
    <span class="bracket"> 〚<span class="id">P</span>〛 <span class="id">c</span> 〚<span class="id">Q</span>〛 </span> that guarantee that <span class="bracket"><span class="id">c</span></span> terminates.
    The only difference with weak triples is the rule for <span class="bracket"><span class="id">while</span></span> loops. </div>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "〚 <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> 〛" (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="alessthan">alessthan</a></span> (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; 0 &lt;= <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span> &lt; <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="HOARE">HOARE</a></span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_skip">HOARE_skip</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> 〚 <span class="id">P</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_assign">HOARE_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> 〚 <span class="id">P</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_seq">HOARE_seq</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id">c1</span> 〚 <span class="id">Q</span> 〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">Q</span> 〛 <span class="id">c2</span> 〚 <span class="id">R</span> 〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id">c1</span>;;<span class="id">c2</span> 〚 <span class="id">R</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_ifthenelse">HOARE_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛 <span class="id">c1</span> 〚 <span class="id">Q</span> 〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛 <span class="id">c2</span> 〚 <span class="id">Q</span> 〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> 〚 <span class="id">Q</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_while">HOARE_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">v</span> //\\ <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id"><a href="CDF.Hoare.html#alessthan">alessthan</a></span> <span class="id">a</span> <span class="id">v</span> //\\ <span class="id">P</span> 〛) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> 〚 <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_havoc">HOARE_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>) 〛 <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> 〚 <span class="id">Q</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_assert">HOARE_assert</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> 〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛<br/>
&nbsp;&nbsp;| <span class="id"><a name="HOARE_consequence">HOARE_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">P</span>' <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> 〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚 <span class="id">P</span>' 〛 <span class="id">c</span> 〚 <span class="id">Q</span>' 〛<br/>
<br/>
<span class="kwd">where</span> "〚 <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> 〛" := (<span class="id"><a href="CDF.Hoare.html#HOARE">HOARE</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>).<br/>
<br/>
<h2> 2.3. Derived and admissible rules </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_consequence_pre">Hoare_consequence_pre</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">Q</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span>' ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Proof.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">P</span>) (<span class="id">Q</span> := <span class="id">Q</span>); <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aimp">aimp</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_consequence_post">Hoare_consequence_post</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span>' ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</div>
<div class="proofscript" id="proof165">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">P</span>) (<span class="id">Q</span> := <span class="id">Q</span>); <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aimp">aimp</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Floyd_assign">Floyd_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> ⦃ <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x0</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">v</span> //\\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">x0</span>) (<span class="id">P</span> //\\ <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">v</span>))) ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">x0</span> := <span class="id">s</span> <span class="id">x</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">v</span> := <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">s</span>' := <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">v</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">s</span>'' := <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">x0</span> <span class="id">s</span>').<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s</span>'' = <span class="id">s</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>'', <span class="id">s</span>', <span class="id"><a href="CDF.Hoare.html#update">update</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">x1</span>). <span class="tactic">subst</span> <span class="id">x1</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>. } <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span>. <span class="id">exists</span> <span class="id">x0</span>. <span class="id">exists</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="id">cbn</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#update_same">update_same</a></span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>; <span class="id">fold</span> <span class="id">v</span>; <span class="id">fold</span> <span class="id">s</span>'; <span class="id">fold</span> <span class="id">s</span>''. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Some derived constructs, with proof rules. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_ifthen">Hoare_ifthen</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> --&gt;&gt; <span class="id">Q</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c</span> <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof167')">Proof.</div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="DOWHILE">DOWHILE</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) : <span class="id"><a href="CDF.Hoare.html#com">com</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">c</span> ;; <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_dowhile">Hoare_dowhile</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt; (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Q</span> --&gt;&gt; <span class="id">P</span>) -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#DOWHILE">DOWHILE</a></span> <span class="id">c</span> <span class="id">b</span> ⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span> <span class="kwd">with</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">A frame rule for strong triples.  Used to reason about "for" loops below. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="assigns">assigns</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">y</span> <span class="id">a</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">assigns</span> <span class="id">c1</span> <span class="id">x</span> \/ <span class="id">assigns</span> <span class="id">c2</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">assigns</span> <span class="id">c1</span> <span class="id">x</span> \/ <span class="id">assigns</span> <span class="id">c2</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id">assigns</span> <span class="id">c</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">y</span> =&gt; <span class="id">x</span> = <span class="id">y</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="independent">independent</a></span> (<span class="id">A</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">vars</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span> -&gt; <span class="kwd">Prop</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">s1</span> <span class="id">s2</span>: <span class="id"><a href="CDF.Hoare.html#store">store</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ~ <span class="id">vars</span> <span class="id">x</span> -&gt; <span class="id">s1</span> <span class="id">x</span> = <span class="id">s2</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">A</span> <span class="id">s1</span> -&gt; <span class="id">A</span> <span class="id">s2</span>.<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">Tauto</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">s</span> := <span class="tactic">fresh</span> "<span class="id">s</span>" <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#aor">aor</a></span>, <span class="id"><a href="CDF.Hoare.html#aimp">aimp</a></span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">s</span>;<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span> [ <span class="id">H</span>: (<span class="kwd">forall</span> (<span class="id">s</span>': <span class="id"><a href="CDF.Hoare.html#store">store</a></span>), <span class="id">_</span>) |- <span class="id">_</span> ] =&gt; <span class="id">specialize</span> (<span class="id">H</span> <span class="id">s</span>) <span class="kwd">end</span>);<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="HOARE_frame">HOARE_frame</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">R</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;〚 <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> 〛 -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#independent">independent</a></span> <span class="id">R</span> (<span class="id"><a href="CDF.Hoare.html#assigns">assigns</a></span> <span class="id">c</span>) -&gt;<br/>
&nbsp;&nbsp;〚 <span class="id">P</span> //\\ <span class="id">R</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> //\\ <span class="id">R</span> 〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">R</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">IND_SUB</span>: <span class="kwd">forall</span> (<span class="id">vars1</span> <span class="id">vars2</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#independent">independent</a></span> <span class="id">R</span> <span class="id">vars1</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">vars2</span> <span class="id">x</span> -&gt; <span class="id">vars1</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#independent">independent</a></span> <span class="id">R</span> <span class="id">vars2</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#independent">independent</a></span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">with</span> <span class="id">s1</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">IND</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">IND</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_skip">HOARE_skip</a></span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="id">P</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_assign">HOARE_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span>; <span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>]. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">y</span> <span class="id">DIFF</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Hoare.html#update_other">update_other</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_seq">HOARE_seq</a></span> <span class="kwd">with</span> (<span class="id">Q</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHOARE1</span>. <span class="tactic">eapply</span> <span class="id">IND_SUB</span>; <span class="tactic">eauto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHOARE2</span>. <span class="tactic">eapply</span> <span class="id">IND_SUB</span>; <span class="tactic">eauto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_ifthenelse">HOARE_ifthenelse</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="id">Q</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHOARE1</span>. <span class="tactic">eapply</span> <span class="id">IND_SUB</span>; <span class="tactic">eauto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="id">Q</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHOARE2</span>. <span class="tactic">eapply</span> <span class="id">IND_SUB</span>; <span class="tactic">eauto</span>. <span class="id">cbn</span>; <span class="tactic">intros</span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">P</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_while">HOARE_while</a></span> <span class="kwd">with</span> <span class="id">a</span>. <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span>. <span class="tactic">apply</span> (<span class="id">H0</span> <span class="id">v</span>). <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>. <span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="id">Q</span> //\\ <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_havoc">HOARE_havoc</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>] <span class="id">n</span>; <span class="tactic">split</span>. <span class="tactic">apply</span> <span class="id">A</span>. <span class="tactic">apply</span> <span class="id">IND</span> <span class="kwd">with</span> <span class="id">s</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">y</span> <span class="id">DIFF</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Hoare.html#update_other">update_other</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_assert">HOARE_assert</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">P</span> //\\ <span class="id">R</span>). <span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHHOARE</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">A counted "for" loop. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="FOR">FOR</a></span> (<span class="id">i</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">l</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) : <span class="id"><a href="CDF.Hoare.html#com">com</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">i</span> <span class="id">l</span>;;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> (<span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">h</span>)) (<span class="id">c</span> ;; <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">i</span> (<span class="id"><a href="CDF.Hoare.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> 1))).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="HOARE_for">HOARE_for</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">h</span> <span class="id">i</span> <span class="id">c</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> (<span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">h</span>)) //\\ <span class="id">P</span> 〛<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span><br/>
&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">i</span> (<span class="id"><a href="CDF.Hoare.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> 1)) <span class="id">P</span> 〛 -&gt;<br/>
&nbsp;&nbsp;~<span class="id"><a href="CDF.Hoare.html#assigns">assigns</a></span> <span class="id">c</span> <span class="id">i</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#assigns">assigns</a></span> <span class="id">c</span> <span class="id">h</span> -&gt; <span class="id">i</span> &lt;&gt; <span class="id">h</span> -&gt; <br/>
&nbsp;&nbsp;〚 <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">i</span> <span class="id">l</span> <span class="id">P</span> 〛 <span class="id"><a href="CDF.Hoare.html#FOR">FOR</a></span> <span class="id">i</span> <span class="id">l</span> <span class="id">h</span> <span class="id">c</span> 〚 <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> (<span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">h</span>)) //\\ <span class="id">P</span> 〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_seq">HOARE_seq</a></span> <span class="kwd">with</span> <span class="id">P</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_assign">HOARE_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">variant</span> := <span class="id"><a href="CDF.Hoare.html#PLUS">PLUS</a></span> (<span class="id"><a href="CDF.Hoare.html#MINUS">MINUS</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">h</span>) (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>)) (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> 1)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_while">HOARE_while</a></span> <span class="kwd">with</span> (<span class="id">a</span> := <span class="id">variant</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">v</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_seq">HOARE_seq</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_frame">HOARE_frame</a></span> <span class="kwd">with</span> (<span class="id">R</span> := <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> (<span class="id"><a href="CDF.Hoare.html#LESSEQUAL">LESSEQUAL</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">i</span>) (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">h</span>))).<br/>
&nbsp;&nbsp;<span class="id">eexact</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">E</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">E</span> <span class="id">i</span>), (<span class="id">E</span> <span class="id">h</span>) <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">A</span>. <span class="id">eexact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_consequence">HOARE_consequence</a></span> <span class="kwd">with</span> (<span class="id">Q</span> := <span class="id"><a href="CDF.Hoare.html#alessthan">alessthan</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#HOARE_assign">HOARE_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="kwd">in</span> <span class="id">B</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">B</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="kwd">in</span> <span class="id">C</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">C</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.leb_le">Z.leb_le</a></span> <span class="kwd">in</span> <span class="id">C</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">red</span>; <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Hoare.html#update_same">update_same</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Hoare.html#update_other">update_other</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">A</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Some inversion lemmas. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_skip_inv">Hoare_skip_inv</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> ⦃ <span class="id">Q</span> ⦄ -&gt; (<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof171')">Proof.</div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H1</span>, <span class="id">IHHoare</span>, <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_assign_inv">Hoare_assign_inv</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> ⦃ <span class="id">Q</span> ⦄ -&gt; (<span class="id">P</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">intros</span>; <span class="tactic">red</span>. <span class="tactic">apply</span> <span class="id">H1</span>, <span class="id">IHHoare</span>, <span class="id">H0</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_seq_inv">Hoare_seq_inv</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c1</span> ;; <span class="id">c2</span>  ⦃ <span class="id">Q</span>  ⦄ -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">R</span>, ⦃ <span class="id">P</span> ⦄ <span class="id">c1</span> ⦃ <span class="id">R</span> ⦄ /\ ⦃ <span class="id">R</span> ⦄ <span class="id">c2</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="id">exists</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHHoare</span> <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">C1</span> &amp; <span class="id">C2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">R</span>; <span class="tactic">split</span>; <span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>, <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c1</span> ⦃ <span class="id">Q</span> ⦄ /\ ⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄ <span class="id">c2</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHHoare</span> <span class="kwd">as</span> (<span class="id">C1</span> &amp; <span class="id">C2</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>; <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>]; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_while_inv">Hoare_while_inv</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">c</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">Inv</span>, ⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Inv</span> ⦄<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="id">P</span> --&gt;&gt; <span class="id">Inv</span>) /\ (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> --&gt;&gt; <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">c</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="id">exists</span> <span class="id">P</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="id">Tauto</span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHHoare</span> <span class="kwd">as</span> (<span class="id">Inv</span> &amp; <span class="id">C</span> &amp; <span class="id">X</span> &amp; <span class="id">Y</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">Inv</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="id">Tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_havoc_inv">Hoare_havoc_inv</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> ⦃ <span class="id">Q</span> ⦄ -&gt; (<span class="id">P</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span> <span class="id">n</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">IHHoare</span>; <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_assert_inv">Hoare_assert_inv</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">R</span>, (<span class="id">P</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span>) /\ (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span> --&gt;&gt; <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof177')">Proof.</div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">b</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>; <span class="tactic">dependent</span> <span class="tactic">induction</span> <span class="id">H</span>.<br/>
- <span class="id">exists</span> <span class="id">P</span>; <span class="tactic">split</span>; <span class="id">Tauto</span>.<br/>
- <span class="id">edestruct</span> <span class="id">IHHoare</span> <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>); <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">R</span>; <span class="tactic">split</span>; <span class="id">Tauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Some admissible rules. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_conj">Hoare_conj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q1</span> <span class="id">Q2</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P1</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q1</span> ⦄ -&gt; ⦃ <span class="id">P2</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q2</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id">P1</span> //\\ <span class="id">P2</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q1</span> //\\ <span class="id">Q2</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="kwd">in</span> *; <span class="id">Tauto</span>. <br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">R1</span> &amp; <span class="id">C11</span> &amp; <span class="id">C21</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">R2</span> &amp; <span class="id">C12</span> &amp; <span class="id">C22</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> (<span class="id">R1</span> //\\ <span class="id">R2</span>); <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">C11</span> &amp; <span class="id">C21</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">C12</span> &amp; <span class="id">C22</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Inv1</span> &amp; <span class="id">C1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">Inv2</span> &amp; <span class="id">C2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">Inv1</span> //\\ <span class="id">Inv2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eapply</span> <span class="id">IHc</span>; <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">R1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">R2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">R1</span> //\\ <span class="id">R2</span>).<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span>, <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="kwd">in</span> *; <span class="id">Tauto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_disj">Hoare_disj</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q1</span> <span class="id">Q2</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P1</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q1</span> ⦄ -&gt; ⦃ <span class="id">P2</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q2</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id">P1</span> \\// <span class="id">P2</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q1</span> \\// <span class="id">Q2</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</div>
<div class="proofscript" id="proof179">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="kwd">in</span> *; <span class="id">Tauto</span>. <br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">R1</span> &amp; <span class="id">C11</span> &amp; <span class="id">C21</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">R2</span> &amp; <span class="id">C12</span> &amp; <span class="id">C22</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> (<span class="id">R1</span> \\// <span class="id">R2</span>); <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">C11</span> &amp; <span class="id">C21</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">C12</span> &amp; <span class="id">C22</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">Inv1</span> &amp; <span class="id">C1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">Inv2</span> &amp; <span class="id">C2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">Inv1</span> \\// <span class="id">Inv2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">eapply</span> <span class="id">IHc</span>; <span class="tactic">eauto</span>. <span class="id">Tauto</span>.<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (<span class="id">R1</span> &amp; <span class="id">A1</span> &amp; <span class="id">B1</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>. <span class="tactic">destruct</span> <span class="id">H0</span> <span class="kwd">as</span> (<span class="id">R2</span> &amp; <span class="id">A2</span> &amp; <span class="id">B2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">R1</span> \\// <span class="id">R2</span>).<br/>
&nbsp;&nbsp;<span class="id">Tauto</span>. <span class="id">Tauto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span> <span class="kwd">in</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span>, <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="kwd">in</span> *; <span class="id">Tauto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="choice_axiom">choice_axiom</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>) (<span class="id">R</span>: <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">exists</span> <span class="id">b</span>, <span class="id">R</span> <span class="id">a</span> <span class="id">b</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">B</span>, <span class="kwd">forall</span> <span class="id">a</span>, <span class="id">R</span> <span class="id">a</span> (<span class="id">f</span> <span class="id">a</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_exists">Hoare_exists</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#choice_axiom">choice_axiom</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) <span class="id">c</span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ⦃ <span class="id">P</span> <span class="id">x</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> <span class="id">x</span> ⦄) -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">CHOICE</span> <span class="id">X</span>. <span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>) <span class="tactic">by</span> (<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">x</span> &amp; <span class="id">Px</span>). <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">y</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> (<span class="id">Q</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">y</span> &amp; <span class="id">Py</span>). <span class="id">exists</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
- <span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt; <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id">P</span> <span class="id">x</span>) <span class="id">c1</span> <span class="id">R</span> /\ <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> <span class="id">R</span> <span class="id">c2</span> (<span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">R</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">H</span>').<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc1</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc2</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H</span>'.<br/>
- <span class="tactic">assert</span> (<span class="id">H1</span>: <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> <span class="id">x</span>)) <span class="id">c1</span> (<span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">Q</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHc1</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H2</span>: <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> <span class="id">x</span>)) <span class="id">c2</span> (<span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">Q</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHc2</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">x</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">x</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">Inv</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span>) <span class="id">c</span> <span class="id">Inv</span> /\ (<span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id">Inv</span>) /\ (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">Inv</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">Inv</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">Inv</span> &amp; <span class="id">H</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">Inv</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">H</span>'. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">x</span> &amp; <span class="id">B</span>); <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">x</span> &amp; <span class="id">A</span>). <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">x</span> &amp; <span class="id">B</span>); <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span>) /\ (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">R</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">A</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">x</span> &amp; <span class="id">Px</span>). <span class="tactic">destruct</span> (<span class="id">A</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">apply</span> <span class="id">B</span> <span class="kwd">in</span> <span class="id">Px</span>. <span class="tactic">destruct</span> <span class="id">Px</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">x</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">Bs</span> &amp; <span class="id">x</span> &amp; <span class="id">Rx</span>). <span class="tactic">destruct</span> (<span class="id">A</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">B</span> &amp; <span class="id">C</span>). <span class="id">exists</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">C</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">y</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) (<span class="id">Q</span> <span class="id">y</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">y</span> &amp; <span class="id">Py</span>). <span class="id">exists</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Hoare_forall">Hoare_forall</a></span>:<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#choice_axiom">choice_axiom</a></span> -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) (<span class="id">inhabited</span>: <span class="id">X</span>) <span class="id">c</span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, ⦃ <span class="id">P</span> <span class="id">x</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> <span class="id">x</span> ⦄) -&gt;<br/>
&nbsp;&nbsp;⦃ <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</div>
<div class="proofscript" id="proof181">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">CHOICE</span> <span class="id">X</span> <span class="id">inhabited</span>; <span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">H</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>) <span class="tactic">by</span> (<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">H</span>'. <span class="tactic">apply</span> <span class="id">Ps</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">y</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> (<span class="id">Q</span> <span class="id">y</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign_inv">Hoare_assign_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">H</span>'. <span class="tactic">auto</span>. <br/>
- <span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt; <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id">P</span> <span class="id">x</span>) <span class="id">c1</span> <span class="id">R</span> /\ <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> <span class="id">R</span> <span class="id">c2</span> (<span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">R</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq_inv">Hoare_seq_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">H</span>').<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc1</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc2</span>. <span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">H</span>'.<br/>
- <span class="tactic">assert</span> (<span class="id">H1</span>: <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> <span class="id">x</span>)) <span class="id">c1</span> (<span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">Q</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHc1</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H2</span>: <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> <span class="id">x</span>)) <span class="id">c2</span> (<span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">Q</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">IHc2</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H</span> <span class="id">x</span>). <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse_inv">Hoare_ifthenelse_inv</a></span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">B</span>) <span class="id">x</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">A</span> &amp; <span class="id">B</span>) <span class="id">x</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">Inv</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span>) <span class="id">c</span> <span class="id">Inv</span> /\ (<span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id">Inv</span>) /\ (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">Inv</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">Inv</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while_inv">Hoare_while_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">Inv</span> &amp; <span class="id">H</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">Inv</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IHc</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">H</span>'. <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>] <span class="id">x</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">A</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">A</span> <span class="id">B</span>] <span class="id">x</span>. <span class="tactic">apply</span> <span class="id">H</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">REL</span> := <span class="kwd">fun</span> (<span class="id">x</span> : <span class="id">X</span>) (<span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> <span class="id">x</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span>) /\ (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">R</span> --&gt;&gt; <span class="id">Q</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">H</span>': <span class="id">exists</span> <span class="id">R</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>, <span class="kwd">forall</span> <span class="id">x</span>: <span class="id">X</span>, <span class="id">REL</span> <span class="id">x</span> (<span class="id">R</span> <span class="id">x</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">CHOICE</span>. <span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert_inv">Hoare_assert_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>' <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">A</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> <span class="id">R</span>).<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Pall</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">A</span> <span class="id">inhabited</span>) <span class="kwd">as</span> (<span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">apply</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">x</span>. <span class="tactic">destruct</span> (<span class="id">A</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">apply</span> <span class="id">B</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> (<span class="id">Bs</span> &amp; <span class="id">Rall</span>) <span class="id">x</span>. <span class="tactic">destruct</span> (<span class="id">A</span> <span class="id">x</span>) <span class="kwd">as</span> (<span class="id">B</span> &amp; <span class="id">C</span>). <span class="tactic">apply</span> <span class="id">C</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">assert</span> (<span class="id">H</span>': <span class="kwd">forall</span> <span class="id">y</span>, <span class="id">P</span> <span class="id">y</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) (<span class="id">Q</span> <span class="id">y</span>))).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc_inv">Hoare_havoc_inv</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Pall</span> <span class="id">n</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">H</span>'. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> 2.4. Soundness </h2>
<br/>
<h3> Soundness of Hoare logic, in the style of type soundness proofs. </h3>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Soundness1">Soundness1</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness1.Hoare_safe">Hoare_safe</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; ~(<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> <span class="id">Ps</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness1.Hoare_step">Hoare_step</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">s</span> -&gt; <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id">exists</span> <span class="id">P</span>', ⦃ <span class="id">P</span>' ⦄ <span class="id">c</span>' ⦃ <span class="id">Q</span> ⦄ /\ <span class="id">P</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">Ps</span> <span class="id">RED</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">P</span>; <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">exact</span> <span class="id">Ps</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">Q</span>; <span class="tactic">split</span>. <span class="tactic">assumption</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">destruct</span> (<span class="id">IHHoare1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ps</span> <span class="id">H2</span>) <span class="kwd">as</span> (<span class="id">P</span>' &amp; <span class="id">HO</span>' &amp; <span class="id">Ps</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">P</span>'; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="kwd">if</span> <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>' <span class="kwd">then</span> <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> <span class="kwd">else</span> <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>'); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>') <span class="id">eqn</span>:<span class="id">B</span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>); <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">exists</span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span>); <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> <span class="id">P</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="id">inv</span> <span class="id">RED</span>. <span class="id">exists</span> <span class="id">Q</span>; <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id">Ps</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">Ps</span> <span class="kwd">as</span> [<span class="id">Ps1</span> <span class="id">Ps2</span>]. <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span>); <span class="tactic">split</span>. <span class="id">constructor</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H0</span> <span class="kwd">in</span> <span class="id">Ps</span>. <span class="tactic">destruct</span> (<span class="id">IHHoare</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Ps</span> <span class="id">RED</span>) <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">HO</span> &amp; <span class="id">Rs</span>').<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">R</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="Soundness1.Hoare_steps">Hoare_steps</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt; <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">P</span>', ⦃ <span class="id">P</span>' ⦄ <span class="id">c</span>' ⦃ <span class="id">Q</span> ⦄ /\ <span class="id">P</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">cs</span> <span class="id">cs</span>', <span class="id"><a href="CDF.Sequences.html#star">star</a></span> <span class="tactic">red</span> <span class="id">cs</span> <span class="id">cs</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>, <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> <span class="id">P</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">cs</span>) <span class="id">Q</span> -&gt; <span class="id">P</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">cs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">P</span>', <span class="id"><a href="CDF.Hoare.html#Hoare">Hoare</a></span> <span class="id">P</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">cs</span>') <span class="id">Q</span> /\ <span class="id">P</span>' (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">cs</span>')).<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id">exists</span> <span class="id">P</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">s1</span>], <span class="id">b</span> <span class="kwd">as</span> [<span class="id">c2</span> <span class="id">s2</span>], <span class="id">c</span> <span class="kwd">as</span> [<span class="id">c3</span> <span class="id">s3</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#Soundness1.Hoare_step">Hoare_step</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H1</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">H2</span> <span class="id">H</span>) <span class="kwd">as</span> (<span class="id">R</span> &amp; <span class="id">HO</span> &amp; <span class="id">Rs2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">IHstar</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">eapply</span> (<span class="id">REC</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>')); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="Soundness1.Hoare_sound">Hoare_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt; <span class="id">P</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;~ <span class="id"><a href="CDF.Hoare.html#goeswrong">goeswrong</a></span> <span class="id">c</span> <span class="id">s</span> /\ (<span class="kwd">forall</span> <span class="id">s</span>', <span class="id"><a href="CDF.Hoare.html#terminates">terminates</a></span> <span class="id">c</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">Q</span> <span class="id">s</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">HO</span> <span class="id">Ps</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">c</span>' &amp; <span class="id">s</span>' &amp; <span class="id">RED</span> &amp; <span class="id">STUCK</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#Soundness1.Hoare_steps">Hoare_steps</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">HO</span> <span class="id">Ps</span> <span class="id">RED</span>) <span class="kwd">as</span> (<span class="id">P</span>' &amp; <span class="id">HO</span>' &amp; <span class="id">Ps</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness1.Hoare_safe">Hoare_safe</a></span>; <span class="tactic">eauto</span>. <br/>
- <span class="tactic">intros</span> <span class="id">s</span>' (<span class="id">c</span>' &amp; <span class="id">RED</span> &amp; <span class="id">TERM</span>). <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">TERM</span>. <span class="tactic">subst</span> <span class="id">c</span>'.  <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#Soundness1.Hoare_steps">Hoare_steps</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> <span class="id">HO</span> <span class="id">Ps</span> <span class="id">RED</span>) <span class="kwd">as</span> (<span class="id">P</span>' &amp; <span class="id">HO</span>' &amp; <span class="id">Ps</span>').<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip_inv">Hoare_skip_inv</a></span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#Soundness1">Soundness1</a></span>.<br/>
<br/>
<h3> Soundness of strong Hoare logic, using an inductive "safe" predicate. </h3>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Soundness2">Soundness2</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Soundness2.safe">safe</a></span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>): <span class="id"><a href="CDF.Hoare.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness2.safe_now">safe_now</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness2.safe_step">safe_step</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">c</span>' <span class="id">s</span>', <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span>' <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Soundness2.Triple">Triple</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Notation</span> "〚〚 <span class="id">P</span> 〛〛 <span class="id">c</span> 〚〚 <span class="id">Q</span> 〛〛" := (<span class="id"><a href="CDF.Hoare.html#Soundness2.Triple">Triple</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_skip">Triple_skip</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> 〚〚 <span class="id">P</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_now">safe_now</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_assign">Triple_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> 〛〛 <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> 〚〚 <span class="id">P</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <br/>
- <span class="id">cbn</span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_now">safe_now</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">exact</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Soundness2.safe_seq">safe_seq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>': <span class="id"><a href="CDF.Hoare.html#com">com</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">Q</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">R</span> <span class="id">c</span>' <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">R</span> (<span class="id">c</span> ;; <span class="id">c</span>') <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c2</span> <span class="id">QR</span>. <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id">QR</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">H2</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_seq">Triple_seq</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id">c1</span> 〚〚 <span class="id">Q</span> 〛〛 -&gt; 〚〚 <span class="id">Q</span> 〛〛 <span class="id">c2</span> 〚〚 <span class="id">R</span> 〛〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id">c1</span>;;<span class="id">c2</span> 〚〚 <span class="id">R</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_seq">safe_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_ifthenelse">Triple_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛〛 <span class="id">c1</span> 〚〚 <span class="id">Q</span> 〛〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛〛 <span class="id">c2</span> 〚〚 <span class="id">Q</span> 〛〛 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> 〚〚 <span class="id">Q</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>') <span class="id">eqn</span>:<span class="id">B</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_while">Triple_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span> 〛〛<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#alessthan">alessthan</a></span> <span class="id">variant</span> <span class="id">v</span> //\\ <span class="id">P</span> 〛〛)<br/>
&nbsp;&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> 〚〚 <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof191')">Proof.</div>
<div class="proofscript" id="proof191">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">variant</span> <span class="id">b</span> <span class="id">c</span> <span class="id">T</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">v</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s</span> = <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) (<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">s</span> ).<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> <span class="id">v</span> <span class="kwd">using</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Wf.html#well_founded_induction">well_founded_induction</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.lt_wf">Z.lt_wf</a></span> 0)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_now">safe_now</a></span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_seq">safe_seq</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#alessthan">alessthan</a></span> <span class="id">variant</span> (<span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s</span>') //\\ <span class="id">P</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>'' [<span class="id">PRE1</span> <span class="id">PRE2</span>]. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">PRE1</span>. <span class="tactic">eapply</span> <span class="id">H</span>. <span class="id">eexact</span> <span class="id">PRE1</span>. <span class="tactic">exact</span> <span class="id">PRE2</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">T</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">red</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id">REC</span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">variant</span> <span class="id">s</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_havoc">Triple_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>) 〛〛 <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> 〚〚 <span class="id">Q</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof192')">Proof.</div>
<div class="proofscript" id="proof192">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="id">constructor</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_assert">Triple_assert</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛〛 <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> 〚〚 <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof193')">Proof.</div>
<div class="proofscript" id="proof193">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">s</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>]. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">PRE1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_now">safe_now</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness2.Triple_consequence">Triple_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">P</span>' <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span> 〛〛 <span class="id">c</span> 〚〚 <span class="id">Q</span> 〛〛 -&gt; <span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt; <span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;〚〚 <span class="id">P</span>' 〛〛 <span class="id">c</span> 〚〚 <span class="id">Q</span>' 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof194')">Proof.</div>
<div class="proofscript" id="proof194">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness2.safe">safe</a></span> <span class="id">Q</span>' <span class="id">c</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_now">safe_now</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.safe_step">safe_step</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Soundness2.HOARE_sound">HOARE_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>, 〚 <span class="id">P</span> 〛 <span class="id">c</span> 〚 <span class="id">Q</span> 〛 -&gt; 〚〚 <span class="id">P</span> 〛〛 <span class="id">c</span> 〚〚 <span class="id">Q</span> 〛〛.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof195')">Proof.</div>
<div class="proofscript" id="proof195">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_skip">Triple_skip</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_assign">Triple_assign</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_seq">Triple_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_ifthenelse">Triple_ifthenelse</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_while">Triple_while</a></span> <span class="kwd">with</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_havoc">Triple_havoc</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_assert">Triple_assert</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness2.Triple_consequence">Triple_consequence</a></span> <span class="kwd">with</span> <span class="id">P</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#Soundness2">Soundness2</a></span>.<br/>
<br/>
<h3> Soundness of weak Hoare logic, using a coinductive "safe" predicate. </h3>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Soundness3">Soundness3</a></span>.<br/>
<br/>
<span class="kwd">CoInductive</span> <span class="id"><a name="Soundness3.safe">safe</a></span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>): <span class="id"><a href="CDF.Hoare.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness3.safe_now">safe_now</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness3.safe_step">safe_step</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">c</span>' <span class="id">s</span>', <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span>' <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.safe_terminated_inv">safe_terminated_inv</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof196')">Proof.</div>
<div class="proofscript" id="proof196">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.safe_not_stuck">safe_not_stuck</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; ~(<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof197')">Proof.</div>
<div class="proofscript" id="proof197">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="id">contradiction</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.safe_step_inv">safe_step_inv</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof198')">Proof.</div>
<div class="proofscript" id="proof198">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">subst</span> <span class="id">c</span>; <span class="id">inv</span> <span class="id">H0</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Soundness3.triple">triple</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Notation</span> "⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄" := (<span class="id"><a href="CDF.Hoare.html#Soundness3.triple">triple</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_skip">triple_skip</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> ⦃⦃ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof199')">Proof.</div>
<div class="proofscript" id="proof199">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_assign">triple_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> ⦃⦃ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof200')">Proof.</div>
<div class="proofscript" id="proof200">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <br/>
- <span class="id">cbn</span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>. <span class="tactic">reflexivity</span>. <span class="tactic">exact</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Soundness3.safe_seq">safe_seq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>': <span class="id"><a href="CDF.Hoare.html#com">com</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>, <span class="id">Q</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">R</span> <span class="id">c</span>' <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">R</span> (<span class="id">c</span> ;; <span class="id">c</span>') <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof201')">Proof.</div>
<div class="proofscript" id="proof201">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c2</span> <span class="id">QR</span>. <span class="id">cofix</span> <span class="id">CHR</span>; <span class="tactic">destruct</span> 1.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="tactic">inversion</span> <span class="id">RED</span>; <span class="tactic">clear</span> <span class="id">RED</span>. <span class="tactic">rewrite</span> &lt;- <span class="id">H4</span>. <span class="tactic">apply</span> <span class="id">QR</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inv</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="tactic">inversion</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">elim</span> <span class="id">H</span>; <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">CHR</span>. <span class="tactic">apply</span> <span class="id">H1</span>; <span class="tactic">auto</span>.<br/>
Defined.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_seq">triple_seq</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c1</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt; ⦃⦃ <span class="id">Q</span> ⦄⦄ <span class="id">c2</span> ⦃⦃ <span class="id">R</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c1</span>;;<span class="id">c2</span> ⦃⦃ <span class="id">R</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof202')">Proof.</div>
<div class="proofscript" id="proof202">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_seq">safe_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_while">triple_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">P</span>  ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> ⦃⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof203')">Proof.</div>
<div class="proofscript" id="proof203">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span> <span class="id">T</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) (<span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span>) <span class="id">s</span> ).<br/>
&nbsp;&nbsp;{ <span class="id">cofix</span> <span class="id">CHR</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="tactic">inversion</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_seq">safe_seq</a></span> <span class="kwd">with</span> <span class="id">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>'' <span class="id">Ps</span>''. <span class="tactic">apply</span> <span class="id">CHR</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">T</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id">REC</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_ifthenelse">triple_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c1</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c2</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof204')">Proof.</div>
<div class="proofscript" id="proof204">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>') <span class="id">eqn</span>:<span class="id">B</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_havoc">triple_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>) ⦄⦄ <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof205')">Proof.</div>
<div class="proofscript" id="proof205">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="id">constructor</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_assert">triple_assert</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> ⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof206')">Proof.</div>
<div class="proofscript" id="proof206">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">s</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>]. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">PRE1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness3.triple_consequence">triple_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">P</span>' <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt; <span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt; <span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span>' ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span>' ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof207')">Proof.</div>
<div class="proofscript" id="proof207">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span>' <span class="id">c</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;{ <span class="id">cofix</span> <span class="id">CH</span>. <span class="tactic">destruct</span> 1.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Soundness3.Hoare_sound">Hoare_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>, ⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt; ⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof208')">Proof.</div>
<div class="proofscript" id="proof208">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_skip">triple_skip</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_assign">triple_assign</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_seq">triple_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_ifthenelse">triple_ifthenelse</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_while">triple_while</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_havoc">triple_havoc</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_assert">triple_assert</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.triple_consequence">triple_consequence</a></span> <span class="kwd">with</span> <span class="id">P</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#Soundness3">Soundness3</a></span>.<br/>
<br/>
<h3> Soundness of weak Hoare logic, using a step-indexed "safe" predicate. </h3>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Soundness4">Soundness4</a></span>.<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="Soundness4.safe">safe</a></span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#com">com</a></span> -&gt; <span class="id"><a href="CDF.Hoare.html#store">store</a></span> -&gt; <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness4.safe_zero">safe_zero</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> <span class="id">c</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness4.safe_now">safe_now</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">c</span> <span class="id">s</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="Soundness4.safe_step">safe_step</a></span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">c</span>' <span class="id">s</span>', <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id">safe</span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span>' <span class="id">s</span>') -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">safe</span> <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Soundness4.triple">triple</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">n</span> <span class="id">s</span>, <span class="id">P</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Notation</span> "⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄" := (<span class="id"><a href="CDF.Hoare.html#Soundness4.triple">triple</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 90, <span class="id">c</span> <span class="tactic">at</span> <span class="id">next</span> <span class="id">level</span>).<br/>
<br/>
<div class="doc">Properties of <span class="bracket"><span class="id">safe</span></span>. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.safe_mono">safe_mono</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="kwd">forall</span> <span class="id">n</span>', (<span class="id">n</span>' &lt;= <span class="id">n</span>)%<span class="id">nat</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span>' <span class="id">c</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof209')">Proof.</div>
<div class="proofscript" id="proof209">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">intros</span>.<br/>
- <span class="tactic">replace</span> <span class="id">n</span>' <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> <span class="tactic">by</span> <span class="id">lia</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">n</span>'. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_now">safe_now</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">n</span>'. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>; <span class="tactic">auto</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">H2</span>; <span class="tactic">auto</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">safe_now</span>': <span class="kwd">forall</span> (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof210')">Proof.</div>
<div class="proofscript" id="proof210">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">n</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_now">safe_now</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.safe_terminated_inv">safe_terminated_inv</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span> -&gt; <span class="id">Q</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof211')">Proof.</div>
<div class="proofscript" id="proof211">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.safe_notstuck">safe_notstuck</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">c</span> <span class="id">s</span> -&gt; ~<span class="id"><a href="CDF.Hoare.html#error">error</a></span> <span class="id">c</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof212')">Proof.</div>
<div class="proofscript" id="proof212">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id">H1</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.safe_step_inv">safe_step_inv</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span> <span class="id">c</span>' <span class="id">s</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">n</span>) <span class="id">c</span> <span class="id">s</span> -&gt; <span class="tactic">red</span> (<span class="id">c</span>, <span class="id">s</span>) (<span class="id">c</span>', <span class="id">s</span>') -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span>' <span class="id">s</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof213')">Proof.</div>
<div class="proofscript" id="proof213">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="id">inv</span> <span class="id">H</span>. <br/>
- <span class="tactic">rewrite</span> <span class="id">H2</span> <span class="kwd">in</span> <span class="id">H0</span>; <span class="id">inv</span> <span class="id">H0</span>.<br/>
- <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Deduction rules. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_skip">triple_skip</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> ⦃⦃ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof214')">Proof.</div>
<div class="proofscript" id="proof214">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">n</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id">safe_now</span>'. <span class="tactic">reflexivity</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_assign">triple_assign</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> ⦃⦃ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof215')">Proof.</div>
<div class="proofscript" id="proof215">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">x</span> <span class="id">a</span> <span class="id">n</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">destruct</span> <span class="id">n</span>. <span class="id">constructor</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>.<br/>
- <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <br/>
- <span class="id">cbn</span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_skip">triple_skip</a></span>. <span class="tactic">exact</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="Soundness4.safe_seq">safe_seq</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">Q</span> <span class="id">R</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>': <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) <span class="id">n</span>,<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">n</span>' <span class="id">s</span>, (<span class="id">n</span>' &lt; <span class="id">n</span>)%<span class="id">nat</span> -&gt; <span class="id">Q</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">R</span> <span class="id">n</span>' <span class="id">c</span>' <span class="id">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">R</span> <span class="id">n</span> (<span class="id">c</span> ;; <span class="id">c</span>') <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof216')">Proof.</div>
<div class="proofscript" id="proof216">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c2</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> <span class="id">QR</span> <span class="id">c</span> <span class="id">s</span> <span class="id">SF</span>.<br/>
- <span class="id">constructor</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="id">cbn</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_notstuck">safe_notstuck</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>. <span class="id">inv</span> <span class="id">RED</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">QR</span>. <span class="id">lia</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_terminated_inv">safe_terminated_inv</a></span>; <span class="tactic">eauto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">IHn</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id">QR</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step_inv">safe_step_inv</a></span>; <span class="tactic">eauto</span>. <br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_seq">triple_seq</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c1</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt; ⦃⦃ <span class="id">Q</span> ⦄⦄ <span class="id">c2</span> ⦃⦃ <span class="id">R</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c1</span>;;<span class="id">c2</span> ⦃⦃ <span class="id">R</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof217')">Proof.</div>
<div class="proofscript" id="proof217">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">n</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_seq">safe_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_while">triple_while</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">P</span>  ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#WHILE">WHILE</a></span> <span class="id">b</span> <span class="id">c</span> ⦃⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof218')">Proof.</div>
<div class="proofscript" id="proof218">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">b</span> <span class="id">c</span> <span class="id">T</span>. <span class="tactic">red</span>. <span class="tactic">induction</span> <span class="id">n</span>; <span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_skip">triple_skip</a></span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_seq">safe_seq</a></span> <span class="kwd">with</span> <span class="id">P</span>. <span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_mono">safe_mono</a></span> <span class="kwd">with</span> <span class="id">n</span>. <span class="tactic">apply</span> <span class="id">IHn</span>; <span class="tactic">auto</span>. <span class="id">lia</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">T</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_ifthenelse">triple_ifthenelse</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c1</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id">c2</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof219')">Proof.</div>
<div class="proofscript" id="proof219">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">n</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">destruct</span> <span class="id">n</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>') <span class="id">eqn</span>:<span class="id">B</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id">H0</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_havoc">triple_havoc</a></span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>) ⦄⦄ <span class="id"><a href="CDF.Hoare.html#HAVOC">HAVOC</a></span> <span class="id">x</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof220')">Proof.</div>
<div class="proofscript" id="proof220">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">n</span> <span class="id">s</span> <span class="id">PRE</span>. <span class="tactic">destruct</span> <span class="id">n</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id">safe_now</span>'. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">PRE</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_assert">triple_assert</a></span>: <span class="kwd">forall</span> <span class="id">b</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄ <span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span> ⦃⦃ <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof221')">Proof.</div>
<div class="proofscript" id="proof221">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">n</span> <span class="id">s</span> [<span class="id">PRE1</span> <span class="id">PRE2</span>]. <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">PRE1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">n</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. <span class="id">cbn</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">c</span>' <span class="id">s</span>' <span class="id">RED</span>; <span class="id">inv</span> <span class="id">RED</span>. <span class="tactic">apply</span> <span class="id">safe_now</span>'; <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Soundness4.triple_consequence">triple_consequence</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">P</span>' <span class="id">Q</span>' <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt; <span class="id">P</span>' --&gt;&gt; <span class="id">P</span> -&gt; <span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⦃⦃ <span class="id">P</span>' ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span>' ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof222')">Proof.</div>
<div class="proofscript" id="proof222">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REC</span>: <span class="kwd">forall</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>, <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span> <span class="id">n</span> <span class="id">c</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Soundness4.safe">safe</a></span> <span class="id">Q</span>' <span class="id">n</span> <span class="id">c</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">induction</span> 1.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_now">safe_now</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.safe_step">safe_step</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Soundness4.Hoare_sound">Hoare_sound</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>, ⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄ -&gt; ⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof223')">Proof.</div>
<div class="proofscript" id="proof223">
&nbsp;&nbsp;<span class="tactic">induction</span> 1.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_skip">triple_skip</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_assign">triple_assign</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_seq">triple_seq</a></span> <span class="kwd">with</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_ifthenelse">triple_ifthenelse</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_while">triple_while</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_havoc">triple_havoc</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_assert">triple_assert</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness4.triple_consequence">triple_consequence</a></span> <span class="kwd">with</span> <span class="id">P</span> <span class="id">Q</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#Soundness4">Soundness4</a></span>.<br/>
<br/>
<h2> 2.5. Completeness </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="Completeness">Completeness</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">Soundness3</span>.<br/>
<br/>
<div class="doc">A weakest (liberal) precondition, defined in terms 
    of the operational semantics. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="Completeness.sem_wp">sem_wp</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">s</span> =&gt; <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id">c</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Completeness.terminated_dec">terminated_dec</a></span>: <span class="kwd">forall</span> <span class="id">c</span>, {<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span>} + {~<span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span> <span class="id">c</span>}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof224')">Proof.</div>
<div class="proofscript" id="proof224">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>. <span class="tactic">destruct</span> <span class="id">c</span>; (<span class="id">left</span>; <span class="tactic">reflexivity</span>) || (<span class="id">right</span>; <span class="tactic">discriminate</span>).<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Completeness.sem_wp_seq">sem_wp_seq</a></span>: <span class="kwd">forall</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">Q</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> (<span class="id">c1</span> ;; <span class="id">c2</span>) <span class="id">Q</span> <span class="id">s</span> -&gt; <span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> <span class="id">c1</span> (<span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> <span class="id">c2</span> <span class="id">Q</span>) <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof225')">Proof.</div>
<div class="proofscript" id="proof225">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span>; <span class="id">cofix</span> <span class="id">CH</span>; <span class="tactic">intros</span> <span class="id">c1</span> <span class="id">c2</span> <span class="id">Q</span> <span class="id">s</span> <span class="id">SAFE</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#Completeness.terminated_dec">terminated_dec</a></span> <span class="id">c1</span>).<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_now">safe_now</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="tactic">eauto</span>. <span class="tactic">rewrite</span> <span class="id">t</span>. <span class="id">constructor</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step">safe_step</a></span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (~ (<span class="id"><a href="CDF.Hoare.html#error">error</a></span> (<span class="id">c1</span>;;<span class="id">c2</span>) <span class="id">s</span>)).  <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_not_stuck">safe_not_stuck</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id">CH</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">SAFE</span>. <span class="id">constructor</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Show that the triple <span class="bracket"> { <span class="id">sem_wp</span> <span class="id">c</span> <span class="id">Q</span> } <span class="id">c</span> { <span class="id">Q</span> } </span> is derivable using the rules
    of Hoare logic. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="Completeness.Hoare_sem_wp">Hoare_sem_wp</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">c</span> <span class="id">Q</span>, ⦃ <span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> <span class="id">c</span> <span class="id">Q</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof226')">Proof.</div>
<div class="proofscript" id="proof226">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span> <span class="id">Q</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">W</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_terminated_inv">safe_terminated_inv</a></span>. <span class="id">eexact</span> <span class="id">W</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">W</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">W</span>': <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> (<span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#aeval">aeval</a></span> <span class="id">a</span> <span class="id">s</span>) <span class="id">s</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">W</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#red_assign">red_assign</a></span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_terminated_inv">safe_terminated_inv</a></span> <span class="kwd">in</span> <span class="id">W</span>'. <span class="tactic">assumption</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> <span class="id">c2</span> <span class="id">Q</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id">IHc1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp_seq">sem_wp_seq</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id">IHc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">P1</span> <span class="id">P2</span>]. <span class="tactic">replace</span> <span class="id">c1</span> <span class="kwd">with</span> (<span class="kwd">if</span> <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">P2</span>. <span class="id">constructor</span>. <span class="tactic">rewrite</span> <span class="id">P1</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id">IHc2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">P1</span> <span class="id">P2</span>]. <span class="tactic">replace</span> <span class="id">c2</span> <span class="kwd">with</span> (<span class="kwd">if</span> <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span>). <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">P2</span>. <span class="id">constructor</span>. <span class="tactic">rewrite</span> <span class="id">P1</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id">IHc</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span> [<span class="id">P1</span> <span class="id">P2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp_seq">sem_wp_seq</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">P2</span>. <span class="id">constructor</span>. <span class="tactic">exact</span> <span class="id">P1</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span> [<span class="id">P1</span> <span class="id">P2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_terminated_inv">safe_terminated_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">P2</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#red_while_done">red_while_done</a></span>. <span class="tactic">exact</span> <span class="id">P1</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence">Hoare_consequence</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span> <span class="id">SAFE</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NOTSTUCK</span>: ~ (<span class="id"><a href="CDF.Hoare.html#error">error</a></span> (<span class="id"><a href="CDF.Hoare.html#ASSERT">ASSERT</a></span> <span class="id">b</span>) <span class="id">s</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_not_stuck">safe_not_stuck</a></span>; <span class="tactic">eauto</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#terminated">terminated</a></span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">B</span>: <span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id">cbn</span> <span class="kwd">in</span> <span class="id">NOTSTUCK</span>. <span class="tactic">destruct</span> (<span class="id"><a href="CDF.Hoare.html#beval">beval</a></span> <span class="id">b</span> <span class="id">s</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">FINAL</span>: <span class="id">Q</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_terminated_inv">safe_terminated_inv</a></span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">SAFE</span>. <span class="id">constructor</span>. <span class="tactic">auto</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">exact</span> <span class="id">B</span>. <span class="tactic">exact</span> <span class="id">FINAL</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>; <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">W</span> <span class="id">n</span>. <br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">W</span>': <span class="id"><a href="CDF.Hoare.html#Soundness3.safe">safe</a></span> <span class="id">Q</span> <span class="id"><a href="CDF.Hoare.html#SKIP">SKIP</a></span> (<span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">n</span> <span class="id">s</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_step_inv">safe_step_inv</a></span>. <span class="id">eexact</span> <span class="id">W</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#red_havoc">red_havoc</a></span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Soundness3.safe_terminated_inv">safe_terminated_inv</a></span> <span class="kwd">in</span> <span class="id">W</span>'. <span class="tactic">assumption</span>. <span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Relative completeness follows. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="Completeness.Hoare_complete">Hoare_complete</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>, ⦃⦃ <span class="id">P</span> ⦄⦄ <span class="id">c</span> ⦃⦃ <span class="id">Q</span> ⦄⦄ -&gt; ⦃ <span class="id">P</span> ⦄ <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof227')">Proof.</div>
<div class="proofscript" id="proof227">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Hoare.html#Completeness.sem_wp">sem_wp</a></span> <span class="id">c</span> <span class="id">Q</span>). <br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Completeness.Hoare_sem_wp">Hoare_sem_wp</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#Completeness">Completeness</a></span>.<br/>
<br/>
<h2> 2.6. Calculating weakest preconditions and verification conditions </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="WP">WP</a></span>.<br/>
<br/>
<div class="doc">Annotated commands. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="WP.com">com</a></span>: <span class="kwd">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.SKIP">SKIP</a></span>                                     <span class="docright">(* do nothing  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.ASSIGN">ASSIGN</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>) (<span class="id">a</span>: <span class="id"><a href="CDF.Hoare.html#aexp">aexp</a></span>)              <span class="docright">(* assignment: <span class="bracket"><span class="id">v</span> := <span class="id">a</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.SEQ">SEQ</a></span> (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>)                  <span class="docright">(* sequence: <span class="bracket"><span class="id">c1</span>; <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.IFTHENELSE">IFTHENELSE</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>) (<span class="id">c2</span>: <span class="id">com</span>) <span class="docright">(* conditional: <span class="bracket"><span class="kwd">if</span> <span class="id">b</span> <span class="kwd">then</span> <span class="id">c1</span> <span class="kwd">else</span> <span class="id">c2</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.WHILE">WHILE</a></span> (<span class="id">Inv</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>) (<span class="id">c1</span>: <span class="id">com</span>) <span class="docright">(* loop: <span class="bracket"><span class="id">while</span> <span class="id">b</span> <span class="tactic">do</span> <span class="id">c1</span> <span class="id">done</span></span>  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.ASSERT">ASSERT</a></span> (<span class="id">b</span>: <span class="id"><a href="CDF.Hoare.html#bexp">bexp</a></span>)                         <span class="docright">(* assertion (error if false)  *)</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="WP.HAVOC">HAVOC</a></span> (<span class="id">x</span>: <span class="id"><a href="CDF.Hoare.html#ident">ident</a></span>).                        <span class="docright">(* nondeterministic assignment  *)</span><br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="WP.erase">erase</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SKIP">SKIP</a></span> =&gt; <span class="id"><a href="CDF.Hoare.html#SKIP">Hoare.SKIP</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.Hoare.html#ASSIGN">Hoare.ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.Hoare.html#SEQ">Hoare.SEQ</a></span> (<span class="id">erase</span> <span class="id">c1</span>) (<span class="id">erase</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id"><a href="CDF.Hoare.html#IFTHENELSE">Hoare.IFTHENELSE</a></span> <span class="id">b</span> (<span class="id">erase</span> <span class="id">c1</span>) (<span class="id">erase</span> <span class="id">c2</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.WHILE">WHILE</a></span> <span class="id">Inv</span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id"><a href="CDF.Hoare.html#WHILE">Hoare.WHILE</a></span> <span class="id">b</span> (<span class="id">erase</span> <span class="id">c</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.Hoare.html#ASSERT">Hoare.ASSERT</a></span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.HAVOC">HAVOC</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#HAVOC">Hoare.HAVOC</a></span> <span class="id">x</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="WP.wlp">wlp</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SKIP">SKIP</a></span> =&gt; <span class="id">Q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> <span class="id">a</span> <span class="id">Q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">wlp</span> <span class="id">c1</span> (<span class="id">wlp</span> <span class="id">c2</span> <span class="id">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">wlp</span> <span class="id">c1</span> <span class="id">Q</span>) \\// (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">wlp</span> <span class="id">c2</span> <span class="id">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.WHILE">WHILE</a></span> <span class="id">Inv</span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id">Inv</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.HAVOC">HAVOC</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aforall">aforall</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">Q</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="WP.vcond">vcond</a></span> (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SKIP">SKIP</a></span> | <span class="id"><a href="CDF.Hoare.html#WP.ASSIGN">ASSIGN</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">vcond</span> <span class="id">c1</span> (<span class="id"><a href="CDF.Hoare.html#WP.wlp">wlp</a></span> <span class="id">c2</span> <span class="id">Q</span>) /\ <span class="id">vcond</span> <span class="id">c2</span> <span class="id">Q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">vcond</span> <span class="id">c1</span> <span class="id">Q</span> /\ <span class="id">vcond</span> <span class="id">c2</span> <span class="id">Q</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.WHILE">WHILE</a></span> <span class="id">Inv</span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vcond</span> <span class="id">c</span> <span class="id">Inv</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#WP.wlp">wlp</a></span> <span class="id">c</span> <span class="id">Inv</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span> --&gt;&gt; <span class="id">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.HAVOC">HAVOC</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="WP.vcgen">vcgen</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#WP.vcond">vcond</a></span> <span class="id">c</span> <span class="id">Q</span> /\ (<span class="id">P</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#WP.wlp">wlp</a></span> <span class="id">c</span> <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="WP.wlp_sound">wlp_sound</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#WP.vcond">vcond</a></span> <span class="id">c</span> <span class="id">Q</span> -&gt; ⦃ <span class="id"><a href="CDF.Hoare.html#WP.wlp">wlp</a></span> <span class="id">c</span> <span class="id">Q</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WP.erase">erase</a></span> <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof228')">Proof.</div>
<div class="proofscript" id="proof228">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span> <span class="id">Q</span> <span class="id">VC</span>; <span class="id">cbn</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assign">Hoare_assign</a></span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> [<span class="id">VC1</span> <span class="id">VC2</span>]. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span>. <span class="tactic">apply</span> <span class="id">IHc1</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IHc2</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> [<span class="id">VC1</span> <span class="id">VC2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#aor">aor</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#aor">aor</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>. <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> (<span class="id">VC1</span> &amp; <span class="id">VC2</span> &amp; <span class="id">VC3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> (<span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span> <span class="id">Inv</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id">IHc</span>; <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id">VC2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">exact</span> <span class="id">VC3</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> [<span class="id">P1</span> <span class="id">P2</span>]; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="WP.vcgen_sound">vcgen_sound</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#WP.vcgen">vcgen</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> -&gt; ⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WP.erase">erase</a></span> <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof229')">Proof.</div>
<div class="proofscript" id="proof229">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> [<span class="id">VC1</span> <span class="id">VC2</span>]. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#WP.wlp_sound">wlp_sound</a></span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#WP">WP</a></span>.<br/>
<br/>
<h2> 2.7. Calculating strongest postconditions and verification conditions </h2>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="SP">SP</a></span>.<br/>
<br/>
<span class="kwd">Import</span> <span class="id">WP</span>.  <span class="docright">(* for annotated commands  *)</span><br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="SP.sp">sp</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) : <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SKIP">SKIP</a></span> =&gt; <span class="id">P</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSIGN">ASSIGN</a></span> <span class="id">x</span> <span class="id">a</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x0</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> (<span class="id"><a href="CDF.Hoare.html#VAR">VAR</a></span> <span class="id">x</span>) <span class="id">v</span> //\\ <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">x0</span>) (<span class="id">P</span> //\\ <span class="id"><a href="CDF.Hoare.html#aequal">aequal</a></span> <span class="id">a</span> <span class="id">v</span>)))<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">sp</span> (<span class="id">sp</span> <span class="id">P</span> <span class="id">c1</span>) <span class="id">c2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">sp</span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) <span class="id">c1</span> \\// <span class="id">sp</span> (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) <span class="id">c2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.WHILE">WHILE</a></span> <span class="id">Inv</span> <span class="id">b</span> <span class="id">c</span> =&gt; <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.HAVOC">HAVOC</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">n</span> =&gt; <span class="id"><a href="CDF.Hoare.html#aupdate">aupdate</a></span> <span class="id">x</span> (<span class="id"><a href="CDF.Hoare.html#CONST">CONST</a></span> <span class="id">n</span>) <span class="id">P</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="SP.vcond">vcond</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SKIP">SKIP</a></span> | <span class="id"><a href="CDF.Hoare.html#WP.ASSIGN">ASSIGN</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.SEQ">SEQ</a></span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">vcond</span> <span class="id">P</span> <span class="id">c1</span> /\ <span class="id">vcond</span> (<span class="id"><a href="CDF.Hoare.html#SP.sp">sp</a></span> <span class="id">P</span> <span class="id">c1</span>) <span class="id">c2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.IFTHENELSE">IFTHENELSE</a></span> <span class="id">b</span> <span class="id">c1</span> <span class="id">c2</span> =&gt; <span class="id">vcond</span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) <span class="id">c1</span> /\ <span class="id">vcond</span> (<span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span> <span class="id">b</span> //\\ <span class="id">P</span>) <span class="id">c2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.WHILE">WHILE</a></span> <span class="id">Inv</span> <span class="id">b</span> <span class="id">c</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">vcond</span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span>) <span class="id">c</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> --&gt;&gt; <span class="id">Inv</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="CDF.Hoare.html#SP.sp">sp</a></span> (<span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span> //\\ <span class="id">Inv</span>) <span class="id">c</span> --&gt;&gt; <span class="id">Inv</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.ASSERT">ASSERT</a></span> <span class="id">b</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span> --&gt;&gt; <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span> <span class="id">b</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="CDF.Hoare.html#WP.HAVOC">HAVOC</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="SP.vcgen">vcgen</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) (<span class="id">c</span>: <span class="id"><a href="CDF.Hoare.html#WP.com">com</a></span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Hoare.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#SP.vcond">vcond</a></span> <span class="id">P</span> <span class="id">c</span> /\ (<span class="id"><a href="CDF.Hoare.html#SP.sp">sp</a></span> <span class="id">P</span> <span class="id">c</span> --&gt;&gt; <span class="id">Q</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="SP.sp_sound">sp_sound</a></span>: <span class="kwd">forall</span> <span class="id">c</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#SP.vcond">vcond</a></span> <span class="id">P</span> <span class="id">c</span> -&gt; ⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WP.erase">erase</a></span> <span class="id">c</span> ⦃ <span class="id"><a href="CDF.Hoare.html#SP.sp">sp</a></span> <span class="id">P</span> <span class="id">c</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof230')">Proof.</div>
<div class="proofscript" id="proof230">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">c</span>; <span class="tactic">intros</span> <span class="id">P</span> <span class="id">VC</span>; <span class="id">cbn</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_skip">Hoare_skip</a></span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Floyd_assign">Floyd_assign</a></span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> [<span class="id">VC1</span> <span class="id">VC2</span>]. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_seq">Hoare_seq</a></span>. <span class="tactic">apply</span> <span class="id">IHc1</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IHc2</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> [<span class="id">VC1</span> <span class="id">VC2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_ifthenelse">Hoare_ifthenelse</a></span>; <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#aor">aor</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>; <span class="tactic">tauto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">s</span>. <span class="tactic">unfold</span> <span class="id"><a href="CDF.Hoare.html#aand">aand</a></span>, <span class="id"><a href="CDF.Hoare.html#aor">aor</a></span>, <span class="id"><a href="CDF.Hoare.html#atrue">atrue</a></span>, <span class="id"><a href="CDF.Hoare.html#afalse">afalse</a></span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">destruct</span> <span class="id">VC</span> <span class="kwd">as</span> (<span class="id">VC1</span> &amp; <span class="id">VC2</span> &amp; <span class="id">VC3</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. 2: <span class="id">eexact</span> <span class="id">VC2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id"><a href="CDF.Hoare.html#Hoare_while">Hoare_while</a></span> <span class="id">Inv</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id">IHc</span>. <span class="id">eexact</span> <span class="id">VC1</span>. <span class="id">eexact</span> <span class="id">VC3</span>.<br/>
- <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">VC</span>. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_assert">Hoare_assert</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_pre">Hoare_consequence_pre</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_havoc">Hoare_havoc</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">s</span> <span class="id">Ps</span> <span class="id">n</span>. <span class="id">exists</span> (<span class="id">s</span> <span class="id">x</span>). <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">s</span>' := <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> <span class="id">n</span> <span class="id">s</span>).<br/>
&nbsp;&nbsp;<span class="tactic">set</span> (<span class="id">s</span>'' := <span class="id"><a href="CDF.Hoare.html#update">update</a></span> <span class="id">x</span> (<span class="id">s</span> <span class="id">x</span>) <span class="id">s</span>').<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">s</span>'' = <span class="id">s</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">s</span>'', <span class="id">s</span>', <span class="id"><a href="CDF.Hoare.html#update">update</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html#string_dec">string_dec</a></span> <span class="id">x</span> <span class="id">y</span>); <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="id">cbn</span>. <span class="id">fold</span> <span class="id">s</span>''. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="SP.vcgen_sound">vcgen_sound</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Hoare.html#SP.vcgen">vcgen</a></span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> -&gt; ⦃ <span class="id">P</span> ⦄ <span class="id"><a href="CDF.Hoare.html#WP.erase">erase</a></span> <span class="id">c</span> ⦃ <span class="id">Q</span> ⦄.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof231')">Proof.</div>
<div class="proofscript" id="proof231">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">c</span> <span class="id">Q</span> [<span class="id">VC1</span> <span class="id">VC2</span>]. <span class="tactic">eapply</span> <span class="id"><a href="CDF.Hoare.html#Hoare_consequence_post">Hoare_consequence_post</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Hoare.html#SP.sp_sound">sp_sound</a></span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="CDF.Hoare.html#SP">SP</a></span>.<br/>
<br/>
<br/>
<br/>
<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
